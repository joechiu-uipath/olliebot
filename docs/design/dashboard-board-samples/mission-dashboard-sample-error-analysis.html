<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Error Analysis — Failure Patterns &amp; Recovery</title>
<script src="https://cdn.jsdelivr.net/npm/echarts@5.6.0/dist/echarts.min.js"></script>
<style>
  *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: #0f1117;
    color: #e0e0e0;
    font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, Roboto, 'Helvetica Neue', Arial, sans-serif;
    line-height: 1.6;
    min-height: 100vh;
    padding: 24px 32px 48px;
  }

  /* ---- Header ---- */
  .dashboard-header {
    margin-bottom: 28px;
    border-bottom: 1px solid #2a2d37;
    padding-bottom: 20px;
  }
  .dashboard-header h1 {
    font-size: 26px;
    font-weight: 700;
    color: #f43f5e;
    letter-spacing: -0.3px;
  }
  .dashboard-header .timestamp {
    font-size: 13px;
    color: #8b8fa3;
    margin-top: 4px;
  }
  .dashboard-header .synopsis {
    font-size: 14px;
    color: #8b8fa3;
    margin-top: 8px;
    max-width: 780px;
    line-height: 1.55;
  }

  /* ---- Interactivity hint ---- */
  .interactivity-hint {
    background: linear-gradient(135deg, rgba(99,102,241,0.10), rgba(244,63,94,0.08));
    border: 1px solid #6366f133;
    border-radius: 8px;
    padding: 12px 18px;
    margin-bottom: 24px;
    font-size: 13px;
    color: #a5b4fc;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .interactivity-hint .icon {
    font-size: 18px;
    flex-shrink: 0;
  }

  /* ---- KPI row ---- */
  .kpi-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
    margin-bottom: 24px;
  }
  .kpi-card {
    background: #1a1d27;
    border: 1px solid #2a2d37;
    border-radius: 10px;
    padding: 20px 22px;
    position: relative;
    overflow: hidden;
  }
  .kpi-card::before {
    content: '';
    position: absolute;
    left: 0; top: 0; bottom: 0;
    width: 4px;
    border-radius: 10px 0 0 10px;
  }
  .kpi-card.alert-error::before { background: #f43f5e; }
  .kpi-card.alert-warn::before  { background: #f59e0b; }
  .kpi-card.alert-ok::before    { background: #10b981; }
  .kpi-card .kpi-label {
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    color: #8b8fa3;
    margin-bottom: 6px;
  }
  .kpi-card .kpi-value {
    font-size: 32px;
    font-weight: 700;
    line-height: 1.15;
  }
  .kpi-card.alert-error .kpi-value { color: #f43f5e; }
  .kpi-card.alert-warn  .kpi-value { color: #f59e0b; }
  .kpi-card.alert-ok    .kpi-value { color: #10b981; }
  .kpi-card .kpi-sub {
    font-size: 12px;
    color: #8b8fa3;
    margin-top: 4px;
  }

  /* ---- Chart grid ---- */
  .grid-2 {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
  }
  .grid-1 {
    margin-bottom: 20px;
  }

  .card {
    background: #1a1d27;
    border: 1px solid #2a2d37;
    border-radius: 10px;
    padding: 20px;
  }
  .card h2 {
    font-size: 15px;
    font-weight: 600;
    color: #e0e0e0;
    margin-bottom: 14px;
  }
  .chart-box {
    width: 100%;
  }

  /* ---- Table ---- */
  .table-wrap {
    overflow-x: auto;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 13px;
  }
  table th {
    text-align: left;
    padding: 10px 12px;
    color: #8b8fa3;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 11px;
    letter-spacing: 0.6px;
    border-bottom: 2px solid #2a2d37;
    cursor: pointer;
    user-select: none;
    white-space: nowrap;
  }
  table th:hover { color: #e0e0e0; }
  table th .sort-arrow { font-size: 10px; margin-left: 4px; opacity: 0.5; }
  table th.sorted .sort-arrow { opacity: 1; color: #6366f1; }
  table td {
    padding: 9px 12px;
    border-bottom: 1px solid #1f2230;
    color: #c5c8d8;
    white-space: nowrap;
  }
  table tr:hover td { background: #1f2230; }
  .badge {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 600;
  }
  .badge-critical { background: #f43f5e22; color: #f43f5e; }
  .badge-warning  { background: #f59e0b22; color: #f59e0b; }
  .badge-info     { background: #6366f122; color: #6366f1; }
  .badge-ok       { background: #10b98122; color: #10b981; }
  .resolved-yes   { color: #10b981; }
  .resolved-no    { color: #f43f5e; }

  /* ---- Responsive ---- */
  @media (max-width: 1100px) {
    .kpi-row { grid-template-columns: repeat(2, 1fr); }
    .grid-2  { grid-template-columns: 1fr; }
  }
  @media (max-width: 600px) {
    body { padding: 14px; }
    .kpi-row { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>

<!-- ===== HEADER ===== -->
<header class="dashboard-header">
  <h1>Error Analysis &mdash; Failure Patterns &amp; Recovery</h1>
  <div class="timestamp">Generated 2026-02-13 14:32:07 UTC &middot; Analysis window: 14 days</div>
  <p class="synopsis">Analysis of errors, retries, and failure modes across the agent system to identify systemic issues.</p>
</header>

<!-- ===== INTERACTIVITY HINT ===== -->
<div class="interactivity-hint">
  <span class="icon">&#9432;</span>
  <span>Click sunburst segments to drill down. Hover timeline points for error details. Click legend items to filter error types.</span>
</div>

<!-- ===== KPIs ===== -->
<div class="kpi-row">
  <div class="kpi-card alert-error">
    <div class="kpi-label">Total Errors</div>
    <div class="kpi-value">23</div>
    <div class="kpi-sub">+5 from previous period</div>
  </div>
  <div class="kpi-card alert-error">
    <div class="kpi-label">Error Rate</div>
    <div class="kpi-value">2.8%</div>
    <div class="kpi-sub">of total operations</div>
  </div>
  <div class="kpi-card alert-ok">
    <div class="kpi-label">Retry Success Rate</div>
    <div class="kpi-value">78%</div>
    <div class="kpi-sub">18 of 23 recovered</div>
  </div>
  <div class="kpi-card alert-ok">
    <div class="kpi-label">Mean Time to Recovery</div>
    <div class="kpi-value">4.2s</div>
    <div class="kpi-sub">avg across all retries</div>
  </div>
</div>

<!-- ===== Row 1: Sunburst + Timeline ===== -->
<div class="grid-2">
  <div class="card">
    <h2>Error Taxonomy</h2>
    <div id="chart-sunburst" class="chart-box" style="height:440px;"></div>
  </div>
  <div class="card">
    <h2>Error Timeline (7 Days)</h2>
    <div id="chart-timeline" class="chart-box" style="height:440px;"></div>
  </div>
</div>

<!-- ===== Row 2: Pie + Horizontal Bar ===== -->
<div class="grid-2">
  <div class="card">
    <h2>Errors by Agent</h2>
    <div id="chart-agents" class="chart-box" style="height:400px;"></div>
  </div>
  <div class="card">
    <h2>Top 10 Error Messages</h2>
    <div id="chart-messages" class="chart-box" style="height:400px;"></div>
  </div>
</div>

<!-- ===== Row 3: Stacked Area ===== -->
<div class="grid-1">
  <div class="card">
    <h2>Error Rate vs Retry Success Rate (14 Days)</h2>
    <div id="chart-rates" class="chart-box" style="height:360px;"></div>
  </div>
</div>

<!-- ===== Row 4: Table ===== -->
<div class="grid-1">
  <div class="card">
    <h2>Recent Errors</h2>
    <div class="table-wrap">
      <table id="error-table">
        <thead>
          <tr>
            <th data-col="0">Time <span class="sort-arrow">&#9650;</span></th>
            <th data-col="1">Agent <span class="sort-arrow">&#9650;</span></th>
            <th data-col="2">Error Type <span class="sort-arrow">&#9650;</span></th>
            <th data-col="3">Message <span class="sort-arrow">&#9650;</span></th>
            <th data-col="4">Retries <span class="sort-arrow">&#9650;</span></th>
            <th data-col="5">Resolved <span class="sort-arrow">&#9650;</span></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>

<script>
/* ========================================================
   SHARED PALETTE
   ======================================================== */
var C = {
  error:   '#f43f5e',
  warn:    '#f59e0b',
  ok:      '#10b981',
  info:    '#6366f1',
  bg:      '#0f1117',
  card:    '#1a1d27',
  border:  '#2a2d37',
  text:    '#e0e0e0',
  muted:   '#8b8fa3'
};

/* shared tooltip style */
function ttStyle() {
  return {
    backgroundColor: '#1e2130',
    borderColor: '#2a2d37',
    textStyle: { color: '#e0e0e0', fontSize: 12 }
  };
}

/* ========================================================
   1. SUNBURST — Error Taxonomy
   ======================================================== */
(function () {
  var dom = document.getElementById('chart-sunburst');
  var chart = echarts.init(dom, null, { renderer: 'canvas' });

  var data = [
    {
      name: 'LLM Errors',
      value: 9,
      itemStyle: { color: '#f43f5e' },
      children: [
        {
          name: 'Rate Limit',
          value: 4,
          itemStyle: { color: '#e1364f' },
          children: [
            { name: '429 Too Many Requests', value: 3, itemStyle: { color: '#c9293f' } },
            { name: 'Quota Exceeded', value: 1, itemStyle: { color: '#b5223a' } }
          ]
        },
        {
          name: 'Context Overflow',
          value: 3,
          itemStyle: { color: '#d63050' },
          children: [
            { name: 'Max tokens exceeded', value: 2, itemStyle: { color: '#bf2845' } },
            { name: 'Context window full', value: 1, itemStyle: { color: '#a8213b' } }
          ]
        },
        {
          name: 'Malformed Response',
          value: 2,
          itemStyle: { color: '#cc2c48' },
          children: [
            { name: 'Invalid JSON output', value: 1, itemStyle: { color: '#b5243e' } },
            { name: 'Empty response body', value: 1, itemStyle: { color: '#a01e35' } }
          ]
        }
      ]
    },
    {
      name: 'Tool Errors',
      value: 7,
      itemStyle: { color: '#f59e0b' },
      children: [
        {
          name: 'Permission Denied',
          value: 3,
          itemStyle: { color: '#d98c09' },
          children: [
            { name: 'EACCES /var/run', value: 2, itemStyle: { color: '#bf7a07' } },
            { name: 'Sudo required', value: 1, itemStyle: { color: '#a66a06' } }
          ]
        },
        {
          name: 'Not Found',
          value: 2,
          itemStyle: { color: '#cc8f0a' },
          children: [
            { name: 'Binary not in PATH', value: 1, itemStyle: { color: '#b37e08' } },
            { name: 'Module missing', value: 1, itemStyle: { color: '#996d07' } }
          ]
        },
        {
          name: 'Execution Failed',
          value: 2,
          itemStyle: { color: '#c0870a' },
          children: [
            { name: 'Non-zero exit code', value: 1, itemStyle: { color: '#a67506' } },
            { name: 'Segfault in child', value: 1, itemStyle: { color: '#8c6305' } }
          ]
        }
      ]
    },
    {
      name: 'Timeout Errors',
      value: 4,
      itemStyle: { color: '#6366f1' },
      children: [
        {
          name: 'LLM Timeout',
          value: 2,
          itemStyle: { color: '#5558d6' },
          children: [
            { name: 'Response >30s', value: 1, itemStyle: { color: '#4a4dbd' } },
            { name: 'Stream stalled', value: 1, itemStyle: { color: '#4042a5' } }
          ]
        },
        {
          name: 'Tool Timeout',
          value: 2,
          itemStyle: { color: '#4f52cc' },
          children: [
            { name: 'HTTP 504 Gateway', value: 1, itemStyle: { color: '#4446b3' } },
            { name: 'Process hung >60s', value: 1, itemStyle: { color: '#393b9a' } }
          ]
        }
      ]
    },
    {
      name: 'Validation Errors',
      value: 3,
      itemStyle: { color: '#10b981' },
      children: [
        {
          name: 'Schema Mismatch',
          value: 2,
          itemStyle: { color: '#0ea572' },
          children: [
            { name: 'Missing required field', value: 1, itemStyle: { color: '#0c9163' } },
            { name: 'Wrong type for "id"', value: 1, itemStyle: { color: '#0a7d55' } }
          ]
        },
        {
          name: 'Input Sanitization',
          value: 1,
          itemStyle: { color: '#0d9e6c' },
          children: [
            { name: 'XSS pattern detected', value: 1, itemStyle: { color: '#0b8a5e' } }
          ]
        }
      ]
    }
  ];

  chart.setOption({
    tooltip: Object.assign({}, ttStyle(), {
      trigger: 'item',
      formatter: function (p) {
        return '<b>' + p.name + '</b><br/>Count: ' + p.value;
      }
    }),
    series: [{
      type: 'sunburst',
      data: data,
      radius: ['12%', '92%'],
      sort: null,
      emphasis: { focus: 'ancestor' },
      levels: [
        {},
        {
          r0: '12%', r: '42%',
          label: { fontSize: 12, color: '#e0e0e0', fontWeight: 600 },
          itemStyle: { borderWidth: 2, borderColor: '#0f1117' }
        },
        {
          r0: '42%', r: '68%',
          label: { fontSize: 11, color: '#c5c8d8' },
          itemStyle: { borderWidth: 1.5, borderColor: '#0f1117' }
        },
        {
          r0: '68%', r: '92%',
          label: { fontSize: 10, color: '#8b8fa3', align: 'right' },
          itemStyle: { borderWidth: 1, borderColor: '#0f1117' }
        }
      ]
    }]
  });

  window.addEventListener('resize', function () { chart.resize(); });
})();

/* ========================================================
   2. TIMELINE — Error scatter on time axis
   ======================================================== */
(function () {
  var dom = document.getElementById('chart-timeline');
  var chart = echarts.init(dom, null, { renderer: 'canvas' });

  var categories = ['LLM Errors', 'Tool Errors', 'Timeout Errors', 'Validation Errors'];
  var catColors = [C.error, C.warn, C.info, C.ok];

  /* Generate data: [timestamp, categoryIndex, severity(1-5)] */
  var raw = [
    ['2026-02-07 02:15', 0, 4], ['2026-02-07 03:10', 0, 3],
    ['2026-02-07 08:42', 1, 2], ['2026-02-07 14:55', 2, 3],
    ['2026-02-08 06:30', 0, 5], ['2026-02-08 06:32', 0, 4],
    ['2026-02-08 06:35', 0, 3], ['2026-02-08 11:20', 1, 2],
    ['2026-02-08 18:45', 3, 1], ['2026-02-09 01:05', 2, 3],
    ['2026-02-09 09:12', 1, 4], ['2026-02-09 15:33', 0, 2],
    ['2026-02-10 04:18', 1, 3], ['2026-02-10 10:50', 3, 2],
    ['2026-02-10 22:14', 2, 4], ['2026-02-11 07:40', 0, 3],
    ['2026-02-11 13:25', 1, 2], ['2026-02-11 19:58', 0, 4],
    ['2026-02-12 03:05', 2, 2], ['2026-02-12 08:15', 1, 3],
    ['2026-02-12 14:30', 3, 1], ['2026-02-13 06:48', 0, 5],
    ['2026-02-13 11:20', 0, 3]
  ];

  var series = categories.map(function (cat, ci) {
    return {
      name: cat,
      type: 'scatter',
      data: raw.filter(function (r) { return r[1] === ci; }).map(function (r) {
        return {
          value: [r[0], ci, r[2]],
          _severity: r[2]
        };
      }),
      symbolSize: function (val) { return val[2] * 8 + 6; },
      itemStyle: { color: catColors[ci], opacity: 0.85 },
      emphasis: {
        itemStyle: { shadowBlur: 10, shadowColor: catColors[ci] }
      }
    };
  });

  chart.setOption({
    tooltip: Object.assign({}, ttStyle(), {
      trigger: 'item',
      formatter: function (p) {
        return '<b>' + categories[p.value[1]] + '</b><br/>' +
               'Time: ' + p.value[0] + '<br/>' +
               'Severity: ' + p.value[2] + '/5';
      }
    }),
    legend: {
      top: 4, left: 'center',
      textStyle: { color: C.muted, fontSize: 11 },
      itemWidth: 12, itemHeight: 12,
      data: categories
    },
    grid: { left: 120, right: 30, top: 40, bottom: 70 },
    xAxis: {
      type: 'time',
      axisLine: { lineStyle: { color: C.border } },
      axisLabel: { color: C.muted, fontSize: 10 },
      splitLine: { show: false }
    },
    yAxis: {
      type: 'category',
      data: categories,
      axisLine: { lineStyle: { color: C.border } },
      axisLabel: { color: C.muted, fontSize: 11 },
      splitLine: { lineStyle: { color: '#1f2230' } }
    },
    dataZoom: [
      { type: 'inside', xAxisIndex: 0 },
      {
        type: 'slider', xAxisIndex: 0, bottom: 10, height: 22,
        borderColor: C.border, fillerColor: 'rgba(99,102,241,0.15)',
        textStyle: { color: C.muted, fontSize: 10 },
        handleStyle: { color: C.info }
      }
    ],
    series: series
  });

  window.addEventListener('resize', function () { chart.resize(); });
})();

/* ========================================================
   3. PIE — Errors by Agent
   ======================================================== */
(function () {
  var dom = document.getElementById('chart-agents');
  var chart = echarts.init(dom, null, { renderer: 'canvas' });

  var agentData = [
    { value: 7, name: 'ResearchAgent' },
    { value: 5, name: 'CodeGenAgent' },
    { value: 4, name: 'PlannerAgent' },
    { value: 3, name: 'ToolRouter' },
    { value: 2, name: 'SummaryAgent' },
    { value: 2, name: 'ValidatorAgent' }
  ];
  var pieColors = ['#f43f5e', '#f59e0b', '#6366f1', '#10b981', '#ec4899', '#8b5cf6'];

  chart.setOption({
    tooltip: Object.assign({}, ttStyle(), {
      trigger: 'item',
      formatter: '{b}: {c} ({d}%)'
    }),
    legend: {
      orient: 'vertical',
      right: 12, top: 'center',
      textStyle: { color: C.muted, fontSize: 11 },
      itemWidth: 10, itemHeight: 10
    },
    series: [{
      type: 'pie',
      radius: ['38%', '72%'],
      center: ['40%', '52%'],
      avoidLabelOverlap: true,
      itemStyle: { borderRadius: 5, borderColor: C.card, borderWidth: 2 },
      label: {
        show: true,
        formatter: '{b|{b}}\n{per|{d}%}  ({c})',
        rich: {
          b: { fontSize: 12, color: C.text, lineHeight: 20, fontWeight: 600 },
          per: { fontSize: 11, color: C.muted, lineHeight: 18 }
        }
      },
      labelLine: { lineStyle: { color: C.border } },
      emphasis: {
        label: { fontSize: 14, fontWeight: 'bold' },
        itemStyle: { shadowBlur: 14, shadowColor: 'rgba(244,63,94,0.35)' }
      },
      data: agentData.map(function (d, i) {
        return Object.assign(d, { itemStyle: { color: pieColors[i] } });
      })
    }]
  });

  window.addEventListener('resize', function () { chart.resize(); });
})();

/* ========================================================
   4. HORIZONTAL BAR — Top 10 Error Messages
   ======================================================== */
(function () {
  var dom = document.getElementById('chart-messages');
  var chart = echarts.init(dom, null, { renderer: 'canvas' });

  var messages = [
    { msg: '429 Too Many Requests', count: 4, sev: 'critical' },
    { msg: 'EACCES: permission denied /var/run/agent.sock', count: 3, sev: 'critical' },
    { msg: 'Max tokens exceeded (128k limit)', count: 2, sev: 'warning' },
    { msg: 'Response timeout after 30000ms', count: 2, sev: 'warning' },
    { msg: 'Binary not found in PATH: ffmpeg', count: 2, sev: 'info' },
    { msg: 'Invalid JSON in LLM response body', count: 1, sev: 'critical' },
    { msg: 'Context window full — cannot append', count: 1, sev: 'warning' },
    { msg: 'HTTP 504 Gateway Timeout upstream', count: 1, sev: 'info' },
    { msg: 'Missing required field: "task_id"', count: 1, sev: 'info' },
    { msg: 'Non-zero exit code (137) in child proc', count: 1, sev: 'warning' }
  ];

  var sevColor = { critical: C.error, warning: C.warn, info: C.info };

  function truncate(s, n) { return s.length > n ? s.substring(0, n) + '...' : s; }

  chart.setOption({
    tooltip: Object.assign({}, ttStyle(), {
      trigger: 'axis',
      axisPointer: { type: 'shadow' },
      formatter: function (ps) {
        var p = ps[0];
        return '<b>' + messages[messages.length - 1 - p.dataIndex].msg + '</b><br/>Count: ' + p.value;
      }
    }),
    grid: { left: 220, right: 30, top: 12, bottom: 12 },
    xAxis: {
      type: 'value',
      axisLine: { lineStyle: { color: C.border } },
      axisLabel: { color: C.muted, fontSize: 10 },
      splitLine: { lineStyle: { color: '#1f2230' } }
    },
    yAxis: {
      type: 'category',
      data: messages.slice().reverse().map(function (m) { return truncate(m.msg, 32); }),
      axisLine: { lineStyle: { color: C.border } },
      axisLabel: { color: C.muted, fontSize: 11, width: 200, overflow: 'truncate' }
    },
    series: [{
      type: 'bar',
      barWidth: 18,
      data: messages.slice().reverse().map(function (m) {
        return {
          value: m.count,
          itemStyle: {
            color: new echarts.graphic.LinearGradient(0, 0, 1, 0, [
              { offset: 0, color: sevColor[m.sev] + '88' },
              { offset: 1, color: sevColor[m.sev] }
            ]),
            borderRadius: [0, 4, 4, 0]
          }
        };
      }),
      label: {
        show: true,
        position: 'right',
        color: C.text,
        fontSize: 11,
        formatter: '{c}'
      }
    }]
  });

  window.addEventListener('resize', function () { chart.resize(); });
})();

/* ========================================================
   5. STACKED AREA — Error Rate vs Retry Success Rate
   ======================================================== */
(function () {
  var dom = document.getElementById('chart-rates');
  var chart = echarts.init(dom, null, { renderer: 'canvas' });

  var days = [];
  for (var d = 0; d < 14; d++) {
    var dt = new Date(2026, 0, 31 + d);   // Jan 31 → Feb 13
    days.push(dt.toISOString().slice(0, 10));
  }

  /* Error rate goes up slightly, retry rate inversely correlated */
  var errorRate  = [1.2, 1.5, 1.8, 2.1, 1.9, 2.4, 2.8, 3.1, 2.6, 3.4, 2.9, 3.2, 2.8, 2.5];
  var retryRate  = [92,  89,  85,  82,  84,  79,  76,  72,  78,  70,  74,  71,  75,  78];

  chart.setOption({
    tooltip: Object.assign({}, ttStyle(), {
      trigger: 'axis',
      axisPointer: { type: 'cross', label: { backgroundColor: '#1e2130' } }
    }),
    legend: {
      top: 4, left: 'center',
      textStyle: { color: C.muted, fontSize: 11 },
      data: ['Error Rate (%)', 'Retry Success Rate (%)']
    },
    grid: { left: 55, right: 55, top: 44, bottom: 68 },
    xAxis: {
      type: 'category',
      boundaryGap: false,
      data: days,
      axisLine: { lineStyle: { color: C.border } },
      axisLabel: { color: C.muted, fontSize: 10, rotate: 30 }
    },
    yAxis: [
      {
        type: 'value',
        name: 'Error Rate %',
        nameTextStyle: { color: C.muted, fontSize: 10 },
        axisLine: { lineStyle: { color: C.error + '66' } },
        axisLabel: { color: C.muted, fontSize: 10 },
        splitLine: { lineStyle: { color: '#1f2230' } },
        min: 0, max: 5
      },
      {
        type: 'value',
        name: 'Retry %',
        nameTextStyle: { color: C.muted, fontSize: 10 },
        axisLine: { lineStyle: { color: C.ok + '66' } },
        axisLabel: { color: C.muted, fontSize: 10 },
        splitLine: { show: false },
        min: 50, max: 100
      }
    ],
    dataZoom: [
      { type: 'inside', xAxisIndex: 0 },
      {
        type: 'slider', xAxisIndex: 0, bottom: 8, height: 22,
        borderColor: C.border, fillerColor: 'rgba(244,63,94,0.12)',
        textStyle: { color: C.muted, fontSize: 10 },
        handleStyle: { color: C.error }
      }
    ],
    series: [
      {
        name: 'Error Rate (%)',
        type: 'line',
        yAxisIndex: 0,
        smooth: true,
        symbol: 'circle',
        symbolSize: 6,
        lineStyle: { color: C.error, width: 2 },
        itemStyle: { color: C.error },
        areaStyle: {
          color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
            { offset: 0, color: 'rgba(244,63,94,0.35)' },
            { offset: 1, color: 'rgba(244,63,94,0.02)' }
          ])
        },
        data: errorRate
      },
      {
        name: 'Retry Success Rate (%)',
        type: 'line',
        yAxisIndex: 1,
        smooth: true,
        symbol: 'circle',
        symbolSize: 6,
        lineStyle: { color: C.ok, width: 2 },
        itemStyle: { color: C.ok },
        areaStyle: {
          color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
            { offset: 0, color: 'rgba(16,185,129,0.30)' },
            { offset: 1, color: 'rgba(16,185,129,0.02)' }
          ])
        },
        data: retryRate
      }
    ]
  });

  window.addEventListener('resize', function () { chart.resize(); });
})();

/* ========================================================
   6. TABLE — Recent Errors (sortable)
   ======================================================== */
(function () {
  var rows = [
    { time: '2026-02-13 11:20:04', agent: 'ResearchAgent',  type: 'LLM',        sev: 'critical', msg: 'Max tokens exceeded (128k limit)',               retries: 2, resolved: true  },
    { time: '2026-02-13 06:48:31', agent: 'CodeGenAgent',    type: 'LLM',        sev: 'critical', msg: '429 Too Many Requests — rate limited',            retries: 3, resolved: true  },
    { time: '2026-02-12 14:30:12', agent: 'ValidatorAgent',  type: 'Validation',  sev: 'info',     msg: 'Missing required field: "task_id"',               retries: 0, resolved: true  },
    { time: '2026-02-12 08:15:44', agent: 'ToolRouter',      type: 'Tool',        sev: 'warning',  msg: 'Binary not found in PATH: ffmpeg',                retries: 1, resolved: false },
    { time: '2026-02-12 03:05:58', agent: 'PlannerAgent',    type: 'Timeout',     sev: 'warning',  msg: 'HTTP 504 Gateway Timeout upstream',                retries: 2, resolved: true  },
    { time: '2026-02-11 19:58:23', agent: 'ResearchAgent',   type: 'LLM',        sev: 'critical', msg: 'Context window full — cannot append',              retries: 1, resolved: false },
    { time: '2026-02-11 13:25:17', agent: 'ToolRouter',      type: 'Tool',        sev: 'critical', msg: 'EACCES: permission denied /var/run/agent.sock',    retries: 0, resolved: false },
    { time: '2026-02-11 07:40:05', agent: 'CodeGenAgent',    type: 'LLM',        sev: 'warning',  msg: 'Invalid JSON in LLM response body',                retries: 2, resolved: true  },
    { time: '2026-02-10 22:14:39', agent: 'PlannerAgent',    type: 'Timeout',     sev: 'warning',  msg: 'Response timeout after 30000ms',                   retries: 3, resolved: true  },
    { time: '2026-02-10 10:50:11', agent: 'SummaryAgent',    type: 'Validation',  sev: 'info',     msg: 'Wrong type for "id": expected string got number',  retries: 0, resolved: true  }
  ];

  var tbody = document.querySelector('#error-table tbody');
  var sortDir = {};

  function badgeClass(sev) {
    return sev === 'critical' ? 'badge-critical' : sev === 'warning' ? 'badge-warning' : 'badge-info';
  }

  function truncate(s, n) { return s.length > n ? s.substring(0, n) + '\u2026' : s; }

  function render(data) {
    tbody.innerHTML = data.map(function (r) {
      return '<tr>' +
        '<td>' + r.time + '</td>' +
        '<td>' + r.agent + '</td>' +
        '<td><span class="badge ' + badgeClass(r.sev) + '">' + r.type + '</span></td>' +
        '<td title="' + r.msg.replace(/"/g, '&quot;') + '">' + truncate(r.msg, 42) + '</td>' +
        '<td style="text-align:center;">' + r.retries + '</td>' +
        '<td style="text-align:center;" class="' + (r.resolved ? 'resolved-yes' : 'resolved-no') + '">' +
          (r.resolved ? 'Yes' : 'No') + '</td>' +
      '</tr>';
    }).join('');
  }

  render(rows);

  /* Sorting */
  var ths = document.querySelectorAll('#error-table th');
  ths.forEach(function (th) {
    th.addEventListener('click', function () {
      var col = parseInt(th.getAttribute('data-col'));
      var key = ['time', 'agent', 'type', 'msg', 'retries', 'resolved'][col];
      sortDir[col] = !sortDir[col];

      /* reset sorted class */
      ths.forEach(function (h) { h.classList.remove('sorted'); });
      th.classList.add('sorted');
      th.querySelector('.sort-arrow').innerHTML = sortDir[col] ? '&#9660;' : '&#9650;';

      rows.sort(function (a, b) {
        var av = a[key], bv = b[key];
        if (typeof av === 'boolean') { av = av ? 1 : 0; bv = bv ? 1 : 0; }
        if (typeof av === 'number') return sortDir[col] ? av - bv : bv - av;
        return sortDir[col] ? String(av).localeCompare(String(bv)) : String(bv).localeCompare(String(av));
      });
      render(rows);
    });
  });
})();
</script>
</body>
</html>
