<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Conversation Funnel Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/echarts@5.6.0/dist/echarts.min.js"></script>
<style>
  *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
  :root{
    --bg:#0f1117;--card:#1a1d27;--border:#2a2d37;
    --text:#e0e0e0;--muted:#8b8fa3;
    --indigo:#6366f1;--cyan:#22d3ee;--green:#10b981;--amber:#f59e0b;--rose:#f43f5e;
  }
  body{
    font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;
    background:var(--bg);color:var(--text);padding:24px 32px;line-height:1.5;
  }

  /* Header */
  .header{margin-bottom:28px}
  .header h1{font-size:1.6rem;font-weight:700;color:#fff;margin-bottom:4px}
  .header .meta{display:flex;gap:18px;align-items:center;flex-wrap:wrap;margin-bottom:10px}
  .header .meta .timestamp{font-size:.82rem;color:var(--muted)}
  .header .synopsis{font-size:.88rem;color:var(--muted);max-width:860px;line-height:1.6}

  /* Interactivity instructions */
  .instructions{
    background:linear-gradient(135deg,rgba(99,102,241,.12),rgba(34,211,238,.08));
    border:1px solid rgba(99,102,241,.25);border-radius:8px;
    padding:12px 18px;margin-bottom:24px;font-size:.82rem;color:var(--cyan);
    display:flex;align-items:center;gap:10px;
  }
  .instructions .icon{font-size:1.1rem;flex-shrink:0}

  /* KPI row */
  .kpi-row{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:24px}
  .kpi-card{
    background:var(--card);border:1px solid var(--border);border-radius:10px;
    padding:20px 22px;position:relative;overflow:hidden;
  }
  .kpi-card::before{
    content:'';position:absolute;top:0;left:0;right:0;height:3px;border-radius:10px 10px 0 0;
  }
  .kpi-card:nth-child(1)::before{background:var(--indigo)}
  .kpi-card:nth-child(2)::before{background:var(--green)}
  .kpi-card:nth-child(3)::before{background:var(--cyan)}
  .kpi-card:nth-child(4)::before{background:var(--amber)}
  .kpi-label{font-size:.78rem;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:8px}
  .kpi-value{font-size:1.85rem;font-weight:700;color:#fff}
  .kpi-card:nth-child(1) .kpi-value{color:var(--indigo)}
  .kpi-card:nth-child(2) .kpi-value{color:var(--green)}
  .kpi-card:nth-child(3) .kpi-value{color:var(--cyan)}
  .kpi-card:nth-child(4) .kpi-value{color:var(--amber)}

  /* Chart cards */
  .chart-card{
    background:var(--card);border:1px solid var(--border);border-radius:10px;
    padding:20px 22px;margin-bottom:20px;
  }
  .chart-card h2{font-size:1rem;font-weight:600;color:#fff;margin-bottom:14px}
  .chart-container{width:100%;height:420px}
  .chart-container.tall{height:480px}
  .chart-container.short{height:360px}

  /* Grid layouts */
  .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px}
  .grid-2 .chart-card{margin-bottom:0}

  @media(max-width:1100px){.grid-2{grid-template-columns:1fr}}
  @media(max-width:900px){.kpi-row{grid-template-columns:repeat(2,1fr)}}
  @media(max-width:560px){.kpi-row{grid-template-columns:1fr}}
</style>
</head>
<body>

<!-- Header -->
<div class="header">
  <h1>Conversation Funnel &mdash; User Interaction Flow</h1>
  <div class="meta">
    <span class="timestamp">Generated Feb 13, 2026 &middot; 09:14 AM UTC &middot; Last 24 h window</span>
  </div>
  <p class="synopsis">Tracks conversations from initial message through agent processing to successful completion, identifying drop-off points.</p>
</div>

<!-- Interactivity instructions -->
<div class="instructions">
  <span class="icon">&#9432;</span>
  <span>Hover funnel segments for conversion rates. Click area chart to see breakdowns. Data zoom available on all time series.</span>
</div>

<!-- KPI Cards -->
<div class="kpi-row">
  <div class="kpi-card">
    <div class="kpi-label">Total Conversations</div>
    <div class="kpi-value">892</div>
  </div>
  <div class="kpi-card">
    <div class="kpi-label">Completion Rate</div>
    <div class="kpi-value">87%</div>
  </div>
  <div class="kpi-card">
    <div class="kpi-label">Avg Turns / Conversation</div>
    <div class="kpi-value">4.3</div>
  </div>
  <div class="kpi-card">
    <div class="kpi-label">Avg Conversation Duration</div>
    <div class="kpi-value">3m 42s</div>
  </div>
</div>

<!-- Funnel Chart -->
<div class="chart-card">
  <h2>Conversation Completion Funnel</h2>
  <div class="chart-container tall" id="funnelChart"></div>
</div>

<!-- Stacked Area Chart -->
<div class="chart-card">
  <h2>Conversation Volume by Outcome (14 days)</h2>
  <div class="chart-container" id="areaChart"></div>
</div>

<!-- Row: Bar+Line combo & Pie -->
<div class="grid-2">
  <div class="chart-card">
    <h2>Avg Response Time by Conversation Turn</h2>
    <div class="chart-container short" id="barLineChart"></div>
  </div>
  <div class="chart-card">
    <h2>Conversation Exit Reasons</h2>
    <div class="chart-container short" id="pieChart"></div>
  </div>
</div>

<!-- Satisfaction line chart -->
<div class="chart-card">
  <h2>User Satisfaction Score Over Time (30 days)</h2>
  <div class="chart-container" id="satisfactionChart"></div>
</div>

<script>
/* =========================================================
   Shared palette & helpers
   ========================================================= */
const C = {
  bg:      '#0f1117',
  card:    '#1a1d27',
  border:  '#2a2d37',
  text:    '#e0e0e0',
  muted:   '#8b8fa3',
  indigo:  '#6366f1',
  cyan:    '#22d3ee',
  green:   '#10b981',
  amber:   '#f59e0b',
  rose:    '#f43f5e',
};

function initChart(id) {
  const el = document.getElementById(id);
  const chart = echarts.init(el, null, { renderer: 'canvas' });
  new ResizeObserver(() => chart.resize()).observe(el);
  return chart;
}

/* =========================================================
   1. Funnel Chart
   ========================================================= */
(function () {
  const chart = initChart('funnelChart');

  const stages = [
    { name: 'Message Received',   value: 892 },
    { name: 'Agent Assigned',     value: 871 },
    { name: 'Processing Started', value: 854 },
    { name: 'First Response',     value: 831 },
    { name: 'Mission Created',    value: 412 },
    { name: 'Mission Completed',  value: 389 },
    { name: 'User Satisfied',     value: 342 },
  ];

  const pcts = ['', '97.6%', '95.7%', '93.2%', '46.2%', '43.6%', '38.3%'];

  // Gradient colours from blue (top) to green (bottom)
  const gradColors = [
    '#6366f1', '#5b7af5', '#4a94ed', '#38aee0',
    '#27c5cc', '#1dccb4', '#10b981'
  ];

  const stepLabels = [];
  for (let i = 1; i < stages.length; i++) {
    const rate = ((stages[i].value / stages[i - 1].value) * 100).toFixed(1);
    stepLabels.push(rate + '%');
  }

  chart.setOption({
    tooltip: {
      trigger: 'item',
      backgroundColor: 'rgba(26,29,39,.95)',
      borderColor: C.border,
      textStyle: { color: C.text, fontSize: 13 },
      formatter: function (p) {
        const idx = stages.findIndex(s => s.name === p.name);
        const ofTotal = ((p.value / 892) * 100).toFixed(1);
        let html = '<b>' + p.name + '</b><br/>Count: ' + p.value.toLocaleString() + '<br/>Of total: ' + ofTotal + '%';
        if (idx > 0) {
          const prev = stages[idx - 1].value;
          html += '<br/>Step conversion: ' + ((p.value / prev) * 100).toFixed(1) + '%';
        }
        return html;
      }
    },
    series: [{
      type: 'funnel',
      left: '12%',
      right: '12%',
      top: 24,
      bottom: 24,
      minSize: '18%',
      maxSize: '92%',
      sort: 'descending',
      gap: 4,
      label: {
        show: true,
        position: 'inside',
        formatter: function (p) {
          const idx = stages.findIndex(s => s.name === p.name);
          return p.name + '\n' + p.value.toLocaleString() + (pcts[idx] ? '  (' + pcts[idx] + ')' : '');
        },
        fontSize: 13,
        fontWeight: 500,
        color: '#fff',
        lineHeight: 20,
      },
      labelLine: { show: false },
      itemStyle: {
        borderWidth: 0,
      },
      emphasis: {
        label: { fontSize: 14, fontWeight: 700 }
      },
      data: stages.map(function (s, i) {
        return {
          name: s.name,
          value: s.value,
          itemStyle: { color: gradColors[i] }
        };
      })
    }]
  });
})();

/* =========================================================
   2. Stacked Area Chart — Conversation Volume by Outcome
   ========================================================= */
(function () {
  const chart = initChart('areaChart');

  const dates = [];
  for (let d = 0; d < 14; d++) {
    const dt = new Date(2026, 1, d); // Feb 2026
    dates.push((dt.getMonth() + 1) + '/' + String(dt.getDate()).padStart(2, '0'));
  }

  const completed  = [52, 58, 61, 55, 63, 67, 59, 62, 70, 65, 68, 72, 64, 66];
  const inProgress = [12, 10, 14, 11, 13, 9,  15, 11, 12, 14, 10, 13, 11, 12];
  const abandoned  = [ 8,  7, 10,  9,  6,  8,  7, 11,  9,  7,  8, 10,  6,  9];
  const failed     = [ 3,  2,  4,  3,  2,  3,  4,  2,  3,  4,  2,  3,  3,  2];

  function makeSeries(name, data, color) {
    return {
      name: name,
      type: 'line',
      stack: 'total',
      areaStyle: { opacity: 0.55 },
      lineStyle: { width: 1.5 },
      symbol: 'circle',
      symbolSize: 5,
      itemStyle: { color: color },
      emphasis: { focus: 'series' },
      data: data,
    };
  }

  chart.setOption({
    tooltip: {
      trigger: 'axis',
      backgroundColor: 'rgba(26,29,39,.95)',
      borderColor: C.border,
      textStyle: { color: C.text, fontSize: 12 },
    },
    legend: {
      top: 0,
      textStyle: { color: C.muted, fontSize: 12 },
      itemWidth: 14, itemHeight: 10,
    },
    grid: { left: 48, right: 24, top: 42, bottom: 72 },
    xAxis: {
      type: 'category',
      data: dates,
      axisLine: { lineStyle: { color: C.border } },
      axisLabel: { color: C.muted, fontSize: 11 },
      axisTick: { show: false },
    },
    yAxis: {
      type: 'value',
      splitLine: { lineStyle: { color: C.border, type: 'dashed' } },
      axisLabel: { color: C.muted, fontSize: 11 },
    },
    dataZoom: [
      { type: 'inside', start: 0, end: 100 },
      { type: 'slider', bottom: 8, height: 22,
        borderColor: C.border, backgroundColor: 'rgba(26,29,39,.6)',
        fillerColor: 'rgba(99,102,241,.18)',
        handleStyle: { color: C.indigo },
        textStyle: { color: C.muted, fontSize: 10 },
        dataBackground: {
          lineStyle: { color: C.indigo, opacity: 0.3 },
          areaStyle: { color: C.indigo, opacity: 0.08 },
        },
      },
    ],
    series: [
      makeSeries('Completed',   completed,  C.green),
      makeSeries('In Progress', inProgress, C.indigo),
      makeSeries('Abandoned',   abandoned,  C.amber),
      makeSeries('Failed',      failed,     C.rose),
    ],
  });
})();

/* =========================================================
   3. Bar + Line Combo — Avg Response Time by Turn
   ========================================================= */
(function () {
  const chart = initChart('barLineChart');

  const turns       = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10'];
  const msgCounts   = [892, 764, 612, 480, 356, 248, 174, 112, 68, 34];
  const avgRespTime = [1.2, 1.4, 1.7, 2.1, 2.6, 3.0, 3.5, 4.2, 5.1, 6.3]; // seconds

  chart.setOption({
    tooltip: {
      trigger: 'axis',
      backgroundColor: 'rgba(26,29,39,.95)',
      borderColor: C.border,
      textStyle: { color: C.text, fontSize: 12 },
      axisPointer: { type: 'shadow' },
    },
    legend: {
      top: 0,
      textStyle: { color: C.muted, fontSize: 12 },
      itemWidth: 14, itemHeight: 10,
    },
    grid: { left: 52, right: 52, top: 44, bottom: 28 },
    xAxis: {
      type: 'category',
      data: turns,
      name: 'Turn #',
      nameLocation: 'center',
      nameGap: 26,
      nameTextStyle: { color: C.muted, fontSize: 11 },
      axisLine: { lineStyle: { color: C.border } },
      axisLabel: { color: C.muted, fontSize: 11 },
      axisTick: { show: false },
    },
    yAxis: [
      {
        type: 'value',
        name: 'Messages',
        nameTextStyle: { color: C.muted, fontSize: 11 },
        splitLine: { lineStyle: { color: C.border, type: 'dashed' } },
        axisLabel: { color: C.muted, fontSize: 11 },
      },
      {
        type: 'value',
        name: 'Resp. Time (s)',
        nameTextStyle: { color: C.muted, fontSize: 11 },
        splitLine: { show: false },
        axisLabel: { color: C.muted, fontSize: 11, formatter: '{value}s' },
      },
    ],
    series: [
      {
        name: 'Message Count',
        type: 'bar',
        data: msgCounts,
        barWidth: '42%',
        itemStyle: {
          color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
            { offset: 0, color: C.indigo },
            { offset: 1, color: 'rgba(99,102,241,.35)' },
          ]),
          borderRadius: [4, 4, 0, 0],
        },
      },
      {
        name: 'Avg Response Time',
        type: 'line',
        yAxisIndex: 1,
        data: avgRespTime,
        symbol: 'circle',
        symbolSize: 7,
        lineStyle: { width: 2.5, color: C.amber },
        itemStyle: { color: C.amber, borderWidth: 2, borderColor: '#fff' },
      },
    ],
  });
})();

/* =========================================================
   4. Pie Chart — Conversation Exit Reasons
   ========================================================= */
(function () {
  const chart = initChart('pieChart');

  const data = [
    { value: 65, name: 'Completed',       color: C.green  },
    { value: 15, name: 'User Abandoned',   color: C.amber  },
    { value:  8, name: 'Timeout',          color: C.cyan   },
    { value:  5, name: 'Error',            color: C.rose   },
    { value:  7, name: 'Redirected',       color: C.indigo },
  ];

  chart.setOption({
    tooltip: {
      trigger: 'item',
      backgroundColor: 'rgba(26,29,39,.95)',
      borderColor: C.border,
      textStyle: { color: C.text, fontSize: 12 },
      formatter: '{b}: {c}% ({d}%)',
    },
    legend: {
      orient: 'vertical',
      right: 16,
      top: 'center',
      textStyle: { color: C.muted, fontSize: 12 },
      itemWidth: 12, itemHeight: 12, itemGap: 14,
    },
    series: [{
      type: 'pie',
      radius: ['44%', '74%'],
      center: ['40%', '50%'],
      avoidLabelOverlap: true,
      itemStyle: { borderColor: C.card, borderWidth: 3, borderRadius: 6 },
      label: {
        show: true,
        color: C.text,
        fontSize: 12,
        formatter: '{b}\n{c}%',
        lineHeight: 18,
      },
      labelLine: { lineStyle: { color: C.border }, length: 12, length2: 16 },
      emphasis: {
        itemStyle: { shadowBlur: 16, shadowColor: 'rgba(0,0,0,.4)' },
        label: { fontWeight: 700, fontSize: 13 },
      },
      data: data.map(function (d) {
        return { value: d.value, name: d.name, itemStyle: { color: d.color } };
      }),
    }],
  });
})();

/* =========================================================
   5. Satisfaction Score Over Time (30 days)
   ========================================================= */
(function () {
  const chart = initChart('satisfactionChart');

  // Generate 30 days of dates
  const dates = [];
  for (let d = 15; d <= 44; d++) {
    // Jan 15 -> Feb 13 2026 (30 days)
    const dt = new Date(2026, 0, d);
    dates.push((dt.getMonth() + 1) + '/' + String(dt.getDate()).padStart(2, '0'));
  }

  // Daily satisfaction scores (1-5)
  const scores = [
    3.8, 3.9, 4.0, 3.7, 3.8, 4.1, 4.2, 4.0, 3.9, 4.1,
    4.3, 4.2, 4.0, 4.1, 4.3, 4.4, 4.2, 4.3, 4.5, 4.4,
    4.3, 4.5, 4.6, 4.4, 4.5, 4.3, 4.6, 4.7, 4.5, 4.6,
  ];

  // Trend line (linear regression)
  const n = scores.length;
  let sumX = 0, sumY = 0, sumXY = 0, sumXX = 0;
  for (let i = 0; i < n; i++) {
    sumX += i; sumY += scores[i]; sumXY += i * scores[i]; sumXX += i * i;
  }
  const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
  const intercept = (sumY - slope * sumX) / n;
  const trend = scores.map(function (_, i) { return +(intercept + slope * i).toFixed(2); });

  // Confidence band (+/- 0.25)
  const bandWidth = 0.25;
  const upper = trend.map(function (v) { return +(v + bandWidth).toFixed(2); });
  const lower = trend.map(function (v) { return +(v - bandWidth).toFixed(2); });

  chart.setOption({
    tooltip: {
      trigger: 'axis',
      backgroundColor: 'rgba(26,29,39,.95)',
      borderColor: C.border,
      textStyle: { color: C.text, fontSize: 12 },
    },
    legend: {
      top: 0,
      textStyle: { color: C.muted, fontSize: 12 },
      itemWidth: 14, itemHeight: 10,
      data: ['Satisfaction Score', 'Trend'],
    },
    grid: { left: 48, right: 24, top: 44, bottom: 72 },
    xAxis: {
      type: 'category',
      data: dates,
      axisLine: { lineStyle: { color: C.border } },
      axisLabel: { color: C.muted, fontSize: 11, interval: 2 },
      axisTick: { show: false },
    },
    yAxis: {
      type: 'value',
      min: 3.0,
      max: 5.0,
      interval: 0.5,
      splitLine: { lineStyle: { color: C.border, type: 'dashed' } },
      axisLabel: { color: C.muted, fontSize: 11, formatter: '{value}' },
    },
    dataZoom: [
      { type: 'inside', start: 0, end: 100 },
      { type: 'slider', bottom: 8, height: 22,
        borderColor: C.border, backgroundColor: 'rgba(26,29,39,.6)',
        fillerColor: 'rgba(99,102,241,.18)',
        handleStyle: { color: C.indigo },
        textStyle: { color: C.muted, fontSize: 10 },
        dataBackground: {
          lineStyle: { color: C.indigo, opacity: 0.3 },
          areaStyle: { color: C.indigo, opacity: 0.08 },
        },
      },
    ],
    series: [
      // Confidence band — upper boundary (invisible line, serves as upper edge)
      {
        name: 'Upper Band',
        type: 'line',
        data: upper,
        lineStyle: { opacity: 0 },
        symbol: 'none',
        stack: 'confidence',
        silent: true,
        tooltip: { show: false },
      },
      // Confidence band — shaded region between lower & upper
      {
        name: 'Confidence Band',
        type: 'line',
        data: lower,
        lineStyle: { opacity: 0 },
        symbol: 'none',
        areaStyle: {
          color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
            { offset: 0, color: 'rgba(99,102,241,.22)' },
            { offset: 1, color: 'rgba(99,102,241,.06)' },
          ]),
        },
        stack: 'confidence',
        silent: true,
        tooltip: { show: false },
      },
      // Trend line
      {
        name: 'Trend',
        type: 'line',
        data: trend,
        symbol: 'none',
        lineStyle: { width: 2, type: 'dashed', color: C.muted },
        itemStyle: { color: C.muted },
        tooltip: {
          valueFormatter: function (v) { return v.toFixed(2); }
        },
      },
      // Actual satisfaction score
      {
        name: 'Satisfaction Score',
        type: 'line',
        data: scores,
        symbol: 'circle',
        symbolSize: 6,
        lineStyle: { width: 2.5, color: C.cyan },
        itemStyle: { color: C.cyan, borderWidth: 2, borderColor: '#fff' },
        tooltip: {
          valueFormatter: function (v) { return v.toFixed(1); }
        },
      },
    ],
  });
})();
</script>
</body>
</html>
