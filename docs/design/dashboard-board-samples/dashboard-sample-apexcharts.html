<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mission Execution Report — ApexCharts BI Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/apexcharts@4.3.0/dist/apexcharts.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked@15.0.7/lib/marked.umd.js"></script>
<style>
  *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
  :root{
    --bg:#0d1117;--card:#161b22;--border:#30363d;
    --text-primary:#c9d1d9;--text-secondary:#8b949e;
    --blue:#58a6ff;--green:#3fb950;--yellow:#d29922;--red:#f85149;--purple:#bc8cff;
    --cyan:#56d4dd;--indigo:#6e7eff;--orange:#db6d28;
    --font:-apple-system,BlinkMacSystemFont,'Segoe UI',Helvetica,Arial,sans-serif;
  }
  html{font-size:14px}
  body{background:var(--bg);color:var(--text-primary);font-family:var(--font);padding:24px;min-height:100vh}

  /* Grid layout */
  .dashboard{display:grid;grid-template-columns:1fr;gap:20px;max-width:1440px;margin:0 auto}
  .row-2{display:grid;grid-template-columns:1fr 1fr;gap:20px}
  .row-5{display:grid;grid-template-columns:repeat(5,1fr);gap:16px}
  .full-width{grid-column:1/-1}

  /* Header */
  .header{display:flex;justify-content:space-between;align-items:flex-start;flex-wrap:wrap;gap:12px;padding:20px 24px;background:var(--card);border:1px solid var(--border);border-radius:10px}
  .header-left h1{font-size:1.65rem;font-weight:700;color:#f0f6fc;letter-spacing:-.02em}
  .header-left p{margin-top:6px;color:var(--text-secondary);font-size:.85rem;line-height:1.5}
  .badge{display:inline-flex;align-items:center;gap:6px;padding:6px 16px;border-radius:20px;font-size:.78rem;font-weight:600;letter-spacing:.06em;text-transform:uppercase}
  .badge-green{background:rgba(63,185,80,.15);color:var(--green);border:1px solid rgba(63,185,80,.3)}
  .badge-green::before{content:'';width:8px;height:8px;border-radius:50%;background:var(--green);animation:pulse 2s infinite}
  @keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}

  /* KPI Cards */
  .kpi-card{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:18px 20px;position:relative;overflow:hidden;transition:border-color .2s}
  .kpi-card:hover{border-color:var(--blue)}
  .kpi-label{font-size:.75rem;color:var(--text-secondary);text-transform:uppercase;letter-spacing:.08em;font-weight:500;margin-bottom:8px}
  .kpi-value{font-size:1.9rem;font-weight:700;color:#f0f6fc;line-height:1}
  .kpi-sub{font-size:.72rem;color:var(--text-secondary);margin-top:8px}
  .kpi-trend{display:inline-flex;align-items:center;gap:3px;font-size:.72rem;font-weight:600;margin-top:6px;padding:2px 8px;border-radius:10px}
  .kpi-trend.up{color:var(--green);background:rgba(63,185,80,.12)}
  .kpi-trend.neutral{color:var(--yellow);background:rgba(210,153,34,.12)}
  .kpi-sparkline{margin-top:8px;height:36px}
  .kpi-sparkline .apexcharts-canvas{overflow:visible !important}

  /* Panels */
  .panel{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:20px 24px;overflow:hidden}
  .panel-title{font-size:.9rem;font-weight:600;color:var(--text-primary);margin-bottom:16px;padding-left:12px;border-left:3px solid var(--blue);line-height:1.4}
  .panel-title.green{border-left-color:var(--green)}
  .panel-title.purple{border-left-color:var(--purple)}
  .panel-title.yellow{border-left-color:var(--yellow)}
  .panel-title.red{border-left-color:var(--red)}
  .panel-title.cyan{border-left-color:var(--cyan)}

  /* Table */
  .table-wrap{overflow-x:auto}
  table{width:100%;border-collapse:collapse;font-size:.8rem}
  th{text-align:left;padding:10px 14px;color:var(--text-secondary);font-weight:600;text-transform:uppercase;letter-spacing:.06em;font-size:.7rem;border-bottom:1px solid var(--border);cursor:pointer;user-select:none;white-space:nowrap;transition:color .15s}
  th:hover{color:var(--blue)}
  th .sort-arrow{margin-left:4px;font-size:.65rem;opacity:.5}
  th.sorted .sort-arrow{opacity:1;color:var(--blue)}
  td{padding:9px 14px;border-bottom:1px solid rgba(48,54,61,.5);white-space:nowrap}
  tr:nth-child(even) td{background:rgba(22,27,34,.5)}
  tr:hover td{background:rgba(88,166,255,.06)}
  td.num{font-family:'SF Mono',SFMono-Regular,Consolas,'Liberation Mono',Menlo,monospace;text-align:right;font-size:.78rem}
  td .model-badge{display:inline-block;padding:2px 8px;border-radius:8px;font-size:.68rem;font-weight:500}
  td .model-opus{background:rgba(188,140,255,.15);color:var(--purple)}
  td .model-sonnet{background:rgba(88,166,255,.15);color:var(--blue)}
  td .model-haiku{background:rgba(86,212,221,.15);color:var(--cyan)}

  /* Markdown */
  .md-content{color:var(--text-primary);line-height:1.7;font-size:.84rem}
  .md-content h2{font-size:1.05rem;color:#f0f6fc;margin:18px 0 10px;padding-bottom:6px;border-bottom:1px solid var(--border)}
  .md-content h3{font-size:.92rem;color:#f0f6fc;margin:14px 0 8px}
  .md-content ul{padding-left:20px;margin:8px 0}
  .md-content li{margin:4px 0}
  .md-content strong{color:#f0f6fc}
  .md-content table{margin:12px 0}
  .md-content th,.md-content td{padding:6px 12px;text-align:left}
  .md-content th{font-size:.72rem}
  .md-content code{background:rgba(110,118,129,.2);padding:2px 6px;border-radius:4px;font-size:.8rem}
  .md-content blockquote{border-left:3px solid var(--blue);padding-left:12px;color:var(--text-secondary);margin:10px 0}

  /* Responsive */
  @media(max-width:1100px){.row-2{grid-template-columns:1fr}.row-5{grid-template-columns:repeat(3,1fr)}}
  @media(max-width:640px){.row-5{grid-template-columns:repeat(2,1fr)}body{padding:12px}}

  /* ApexCharts overrides */
  .apexcharts-tooltip{background:var(--card)!important;border:1px solid var(--border)!important;color:var(--text-primary)!important;font-size:.78rem!important;border-radius:8px!important;box-shadow:0 8px 24px rgba(0,0,0,.4)!important}
  .apexcharts-tooltip-title{background:rgba(48,54,61,.6)!important;border-bottom:1px solid var(--border)!important;color:var(--text-secondary)!important;font-size:.72rem!important}
  .apexcharts-xaxistooltip,.apexcharts-yaxistooltip{background:var(--card)!important;border:1px solid var(--border)!important;color:var(--text-primary)!important;border-radius:6px!important}
  .apexcharts-xaxistooltip::before,.apexcharts-xaxistooltip::after{border-bottom-color:var(--border)!important}
  .apexcharts-legend-text{color:var(--text-secondary)!important;font-size:.75rem!important}
  .apexcharts-gridline{stroke:var(--border)!important}
  .apexcharts-menu{background:var(--card)!important;border:1px solid var(--border)!important}
  .apexcharts-menu-item:hover{background:rgba(88,166,255,.1)!important}
</style>
</head>
<body>

<div class="dashboard">
  <!-- ===== HEADER ===== -->
  <div class="header">
    <div class="header-left">
      <h1>Mission Execution Report</h1>
      <p>Mission: Implement OAuth2 authentication flow &bull; Started: Feb 13 09:15 UTC &bull; Duration: 23m 47s</p>
    </div>
    <div class="badge badge-green">Completed</div>
  </div>

  <!-- ===== KPI ROW ===== -->
  <div class="row-5">
    <div class="kpi-card">
      <div class="kpi-label">Agent Steps</div>
      <div class="kpi-value">12</div>
      <div class="kpi-trend up">&#9650; Efficient</div>
      <div class="kpi-sparkline" id="spark-steps"></div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">LLM Calls</div>
      <div class="kpi-value">34</div>
      <div class="kpi-trend neutral">&#9644; Avg 2.8/step</div>
      <div class="kpi-sparkline" id="spark-tokens"></div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">Tool Invocations</div>
      <div class="kpi-value">67</div>
      <div class="kpi-trend up">&#9650; 5.6/step</div>
      <div class="kpi-sub" style="margin-top:10px">file_read: 23 &bull; file_write: 18 &bull; search: 14 &bull; bash: 12</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">Total Cost</div>
      <div class="kpi-value">$0.47</div>
      <div class="kpi-trend up">&#9650; Under budget</div>
      <div class="kpi-sub" style="margin-top:10px">Input: $0.12 &bull; Output: $0.35</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">Files Modified</div>
      <div class="kpi-value">8</div>
      <div class="kpi-trend up">&#9650; Focused</div>
      <div class="kpi-sub" style="margin-top:10px">+342 lines &bull; -58 lines &bull; 4 new files</div>
    </div>
  </div>

  <!-- ===== ROW 1 ===== -->
  <div class="row-2">
    <div class="panel">
      <div class="panel-title">Agent Execution Timeline</div>
      <div id="chart-timeline"></div>
    </div>
    <div class="panel">
      <div class="panel-title green">Token Budget Utilization</div>
      <div id="chart-radial"></div>
    </div>
  </div>

  <!-- ===== ROW 2 ===== -->
  <div class="row-2">
    <div class="panel">
      <div class="panel-title purple">Per-Step Analysis</div>
      <div id="chart-mixed"></div>
    </div>
    <div class="panel">
      <div class="panel-title yellow">Token Distribution by Agent</div>
      <div id="chart-treemap"></div>
    </div>
  </div>

  <!-- ===== ROW 3 ===== -->
  <div class="panel full-width">
    <div class="panel-title cyan">LLM Call Latency Timeline</div>
    <div id="chart-latency"></div>
    <div id="chart-latency-brush" style="margin-top:-20px"></div>
  </div>

  <!-- ===== ROW 4 ===== -->
  <div class="row-2">
    <div class="panel">
      <div class="panel-title red">Tool Usage by Agent</div>
      <div id="chart-heatmap"></div>
    </div>
    <div class="panel">
      <div class="panel-title">Executive Summary</div>
      <div class="md-content" id="md-summary"></div>
    </div>
  </div>

  <!-- ===== TABLE ===== -->
  <div class="panel full-width">
    <div class="panel-title">LLM Call Details</div>
    <div class="table-wrap">
      <table id="llm-table">
        <thead><tr></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>

<script>
// ============================================================
//  GLOBAL THEME
// ============================================================
const THEME = {
  bg: '#0d1117', card: '#161b22', border: '#30363d',
  text: '#c9d1d9', textSec: '#8b949e', textBright: '#f0f6fc',
  blue: '#58a6ff', green: '#3fb950', yellow: '#d29922',
  red: '#f85149', purple: '#bc8cff', cyan: '#56d4dd',
  indigo: '#6e7eff', orange: '#db6d28'
};

const baseChartOpts = {
  chart: { background: 'transparent', fontFamily: '-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif', foreColor: THEME.textSec },
  grid: { borderColor: THEME.border, strokeDashArray: 3 },
  tooltip: { theme: 'dark' },
  states: { hover: { filter: { type: 'lighten', value: 0.08 } } }
};

function merge(a, b) { return Object.assign({}, JSON.parse(JSON.stringify(a)), b); }

// ============================================================
//  DATA
// ============================================================

// Mission started 09:15:00, ended 09:38:47 UTC Feb 13 2026
const missionStart = new Date('2026-02-13T09:15:00Z').getTime();
const missionEnd   = new Date('2026-02-13T09:38:47Z').getTime();

// Step durations for sparkline (seconds)
const stepDurations = [45, 78, 120, 95, 180, 145, 110, 90, 200, 160, 130, 74];

// Token usage per LLM call for sparkline
const tokensPerCall = [
  820,1450,340,2100,1780,560,3200,980,1650,420,2800,1120,
  890,2400,670,1340,3100,510,1900,2600,780,1550,440,2050,
  1380,3400,620,1750,950,2200,1100,480,1680,2900
];

// ============================================================
//  1. KPI SPARKLINES
// ============================================================
function renderSparkline(el, data, color) {
  new ApexCharts(document.querySelector(el), {
    chart: { type: 'area', height: 36, sparkline: { enabled: true }, animations: { enabled: true, easing: 'easeinout', speed: 800 } },
    series: [{ data }],
    stroke: { width: 2, curve: 'smooth', colors: [color] },
    fill: { type: 'gradient', gradient: { shadeIntensity: 1, opacityFrom: 0.35, opacityTo: 0.05, stops: [0, 100] } },
    colors: [color],
    tooltip: { enabled: false }
  }).render();
}
renderSparkline('#spark-steps', stepDurations, THEME.blue);
renderSparkline('#spark-tokens', tokensPerCall, THEME.purple);

// ============================================================
//  2. TIMELINE / RANGE BAR — Agent Execution Timeline
// ============================================================
(function(){
  const ms = (m,s) => missionStart + m*60000 + s*1000;
  const series = [
    { data: [{ x: 'Supervisor',   y: [ms(0,0),  ms(23,47)], fillColor: THEME.blue }] },
    { data: [{ x: 'MissionLead',  y: [ms(0,12), ms(22,30)], fillColor: THEME.green }] },
    { data: [
      { x: 'Coder',       y: [ms(2,0),  ms(8,45)],  fillColor: THEME.purple },
      { x: 'Coder',       y: [ms(10,20),ms(16,10)],  fillColor: THEME.purple },
      { x: 'Coder',       y: [ms(18,0), ms(22,0)],   fillColor: THEME.purple }
    ]},
    { data: [
      { x: 'Researcher',  y: [ms(1,0),  ms(4,30)],  fillColor: THEME.cyan },
      { x: 'Researcher',  y: [ms(9,0),  ms(11,15)], fillColor: THEME.cyan }
    ]},
    { data: [{ x: 'Reviewer', y: [ms(16,30), ms(21,45)], fillColor: THEME.yellow }] }
  ];

  new ApexCharts(document.querySelector('#chart-timeline'), merge(baseChartOpts, {
    chart: { type: 'rangeBar', height: 280, toolbar: { show: false }, animations: { enabled: true, speed: 600 } },
    plotOptions: { bar: { horizontal: true, barHeight: '55%', borderRadius: 4, rangeBarGroupRows: true } },
    series,
    xaxis: {
      type: 'datetime',
      min: missionStart,
      max: missionEnd,
      labels: { datetimeUTC: true, format: 'HH:mm:ss', style: { colors: THEME.textSec, fontSize: '11px' } }
    },
    yaxis: { labels: { style: { colors: THEME.textSec, fontSize: '12px' } } },
    legend: { show: false },
    tooltip: {
      custom: function({ seriesIndex, dataPointIndex, w }) {
        const dp = w.config.series[seriesIndex].data[dataPointIndex];
        const start = new Date(dp.y[0]).toISOString().substring(11,19);
        const end   = new Date(dp.y[1]).toISOString().substring(11,19);
        const dur   = ((dp.y[1]-dp.y[0])/1000).toFixed(0);
        return `<div style="padding:8px 12px;font-size:12px"><strong>${dp.x}</strong><br/>${start} — ${end}<br/><span style="color:${THEME.textSec}">Duration: ${dur}s</span></div>`;
      }
    },
    grid: { borderColor: THEME.border, xaxis: { lines: { show: true } }, yaxis: { lines: { show: false } }, padding: { left: 10, right: 10 } }
  })).render();
})();

// ============================================================
//  3. RADIAL BAR — Token Budget Utilization
// ============================================================
(function(){
  const inputUsed = 18420, inputBudget = 30000;
  const outputUsed = 42180, outputBudget = 60000;
  const totalUsed = inputUsed + outputUsed, totalBudget = inputBudget + outputBudget;

  new ApexCharts(document.querySelector('#chart-radial'), merge(baseChartOpts, {
    chart: { type: 'radialBar', height: 290 },
    series: [
      Math.round(totalUsed/totalBudget*100),
      Math.round(inputUsed/inputBudget*100),
      Math.round(outputUsed/outputBudget*100)
    ],
    plotOptions: {
      radialBar: {
        offsetY: -10,
        hollow: { size: '30%', background: 'transparent' },
        track: { background: 'rgba(48,54,61,.5)', strokeWidth: '100%' },
        dataLabels: {
          name: { fontSize: '13px', color: THEME.textSec, offsetY: -6 },
          value: { fontSize: '22px', fontWeight: 700, color: THEME.textBright, offsetY: 4, formatter: v => v + '%' },
          total: {
            show: true, label: 'Total Budget', fontSize: '12px', color: THEME.textSec,
            formatter: function(w){ return Math.round(totalUsed/totalBudget*100) + '%'; }
          }
        }
      }
    },
    labels: ['Total', 'Input Tokens', 'Output Tokens'],
    colors: [THEME.blue, THEME.green, THEME.purple],
    stroke: { lineCap: 'round' },
    legend: { show: true, position: 'bottom', fontSize: '12px', labels: { colors: THEME.textSec }, markers: { radius: 2 } }
  })).render();
})();

// ============================================================
//  4. MIXED CHART — Per-Step Analysis
// ============================================================
(function(){
  const stepLabels = Array.from({length:12},(_,i)=>'Step '+(i+1));
  const tokensPerStep = [2850, 4120, 5680, 3940, 7210, 6380, 5100, 4560, 8320, 6840, 5480, 3120];
  const costPerStep   = [0.018,0.032,0.048,0.028,0.068,0.054,0.042,0.036,0.076,0.058,0.044,0.022];
  let cumCost = []; costPerStep.reduce((a,c,i) => { cumCost[i]=a+c; return a+c; }, 0);
  cumCost = cumCost.map(v => +v.toFixed(3));

  new ApexCharts(document.querySelector('#chart-mixed'), merge(baseChartOpts, {
    chart: { type: 'line', height: 300, toolbar: { show: false }, animations: { enabled: true, speed: 600 } },
    series: [
      { name: 'Tokens', type: 'bar', data: tokensPerStep },
      { name: 'Cumulative Cost ($)', type: 'line', data: cumCost }
    ],
    xaxis: { categories: stepLabels, labels: { style: { colors: THEME.textSec, fontSize: '11px' } }, axisBorder: { color: THEME.border }, axisTicks: { color: THEME.border } },
    yaxis: [
      { title: { text: 'Tokens', style: { color: THEME.textSec, fontSize: '11px' } }, labels: { style: { colors: THEME.textSec }, formatter: v => (v/1000).toFixed(1)+'k' } },
      { opposite: true, title: { text: 'Cumulative Cost ($)', style: { color: THEME.textSec, fontSize: '11px' } }, labels: { style: { colors: THEME.textSec }, formatter: v => '$'+v.toFixed(2) } }
    ],
    colors: [THEME.indigo, THEME.yellow],
    plotOptions: { bar: { columnWidth: '50%', borderRadius: 4 } },
    fill: { opacity: [0.85, 1] },
    stroke: { width: [0, 3], curve: 'smooth' },
    markers: { size: [0, 5], colors: [undefined, THEME.yellow], strokeColors: THEME.card, strokeWidth: 2 },
    legend: { position: 'top', horizontalAlign: 'right', labels: { colors: THEME.textSec }, markers: { radius: 2 } },
    tooltip: { shared: true, intersect: false }
  })).render();
})();

// ============================================================
//  5. TREEMAP — Token Distribution by Agent
// ============================================================
(function(){
  new ApexCharts(document.querySelector('#chart-treemap'), merge(baseChartOpts, {
    chart: { type: 'treemap', height: 300, toolbar: { show: false }, animations: { speed: 500 } },
    series: [{
      data: [
        { x: 'Coder — Output',       y: 18200 },
        { x: 'Coder — Input',        y: 8400  },
        { x: 'MissionLead — Output',  y: 9800  },
        { x: 'MissionLead — Input',   y: 4200  },
        { x: 'Researcher — Output',   y: 6400  },
        { x: 'Researcher — Input',    y: 3100  },
        { x: 'Reviewer — Output',     y: 5200  },
        { x: 'Reviewer — Input',      y: 1800  },
        { x: 'Supervisor — Output',   y: 2580  },
        { x: 'Supervisor — Input',    y: 920   }
      ]
    }],
    plotOptions: {
      treemap: {
        distributed: true,
        enableShades: false,
        colorScale: {
          ranges: [
            { from: 0,     to: 2000,  color: THEME.cyan },
            { from: 2001,  to: 5000,  color: THEME.green },
            { from: 5001,  to: 10000, color: THEME.blue },
            { from: 10001, to: 15000, color: THEME.purple },
            { from: 15001, to: 20000, color: THEME.indigo }
          ]
        }
      }
    },
    dataLabels: { enabled: true, style: { fontSize: '12px', fontWeight: 600 }, formatter: (text, op) => [text, (op.value/1000).toFixed(1)+'k tokens'] },
    tooltip: { y: { formatter: v => v.toLocaleString() + ' tokens' } },
    legend: { show: false }
  })).render();
})();

// ============================================================
//  6. AREA CHART + BRUSH — LLM Call Latency Timeline
// ============================================================
(function(){
  // Generate 34 LLM calls with realistic timestamps and latencies
  const calls = [];
  const agentModels = [
    { agent: 'Supervisor', model: 'main', color: THEME.indigo },
    { agent: 'MissionLead', model: 'main', color: THEME.indigo },
    { agent: 'Coder', model: 'main', color: THEME.indigo },
    { agent: 'Coder', model: 'fast', color: THEME.cyan },
    { agent: 'Researcher', model: 'fast', color: THEME.cyan },
    { agent: 'Reviewer', model: 'main', color: THEME.indigo }
  ];
  const baseTs = missionStart;
  const callTimestamps = [
    0,18,45,68,102,135,158,192,230,265,
    298,340,378,415,450,490,532,570,612,658,
    695,740,780,825,870,910,955,998,1040,1085,
    1130,1175,1220,1260
  ].map(s => baseTs + s*1000);

  const latencies = [
    1.2,2.8,0.9,3.4,2.1,0.6,4.2,1.8,2.5,0.7,
    3.8,1.5,2.2,3.1,0.8,1.9,4.5,0.5,2.7,3.6,
    1.1,2.3,0.6,2.9,1.7,4.1,0.9,2.4,1.3,3.0,
    1.6,0.7,2.1,3.3
  ];

  const workloadType = [
    'main','main','fast','main','main','fast','main','fast','main','fast',
    'main','fast','main','main','fast','main','main','fast','main','main',
    'fast','main','fast','main','main','main','fast','main','fast','main',
    'main','fast','main','main'
  ];

  const mainData = callTimestamps.map((t,i) => [t, workloadType[i]==='main' ? latencies[i] : null]);
  const fastData = callTimestamps.map((t,i) => [t, workloadType[i]==='fast' ? latencies[i] : null]);

  // Main chart
  new ApexCharts(document.querySelector('#chart-latency'), merge(baseChartOpts, {
    chart: {
      id: 'latency-main', type: 'area', height: 220, group: 'latency',
      toolbar: { show: false },
      animations: { enabled: true, speed: 600 }
    },
    series: [
      { name: 'Main Workload', data: mainData },
      { name: 'Fast Workload', data: fastData }
    ],
    colors: [THEME.indigo, THEME.cyan],
    fill: { type: 'gradient', gradient: { shadeIntensity: 1, opacityFrom: 0.45, opacityTo: 0.05, stops: [0, 90, 100] } },
    stroke: { width: 2, curve: 'smooth' },
    markers: { size: 4, strokeColors: THEME.card, strokeWidth: 2, hover: { size: 7 } },
    xaxis: {
      type: 'datetime', min: missionStart, max: missionEnd,
      labels: { datetimeUTC: true, format: 'HH:mm:ss', style: { colors: THEME.textSec, fontSize: '11px' } },
      axisBorder: { color: THEME.border }
    },
    yaxis: {
      title: { text: 'Latency (seconds)', style: { color: THEME.textSec, fontSize: '11px' } },
      labels: { style: { colors: THEME.textSec }, formatter: v => v ? v.toFixed(1)+'s' : '' },
      min: 0, max: 5.5
    },
    legend: { position: 'top', horizontalAlign: 'right', labels: { colors: THEME.textSec }, markers: { radius: 2 } },
    tooltip: {
      x: { format: 'HH:mm:ss' },
      y: { formatter: v => v !== null ? v.toFixed(2) + 's' : 'N/A' }
    }
  })).render();

  // Brush chart
  new ApexCharts(document.querySelector('#chart-latency-brush'), merge(baseChartOpts, {
    chart: {
      id: 'latency-brush', type: 'area', height: 80, brush: { target: 'latency-main', enabled: true },
      selection: { enabled: true, xaxis: { min: missionStart, max: missionStart + 10*60000 }, fill: { color: THEME.blue, opacity: 0.15 }, stroke: { color: THEME.blue } },
      toolbar: { show: false, autoSelected: 'selection' }
    },
    series: [
      { name: 'Main', data: mainData },
      { name: 'Fast', data: fastData }
    ],
    colors: [THEME.indigo, THEME.cyan],
    fill: { type: 'gradient', gradient: { opacityFrom: 0.3, opacityTo: 0.05 } },
    stroke: { width: 1, curve: 'smooth' },
    xaxis: {
      type: 'datetime', min: missionStart, max: missionEnd,
      labels: { datetimeUTC: true, format: 'HH:mm', style: { colors: THEME.textSec, fontSize: '10px' } },
      axisBorder: { color: THEME.border }
    },
    yaxis: { show: false, min: 0, max: 5.5 },
    legend: { show: false }
  })).render();
})();

// ============================================================
//  7. HEATMAP — Tool Usage by Agent
// ============================================================
(function(){
  const tools  = ['file_read','file_write','search','bash','web_fetch','lint','test_run'];
  const agents = ['Supervisor','MissionLead','Coder','Researcher','Reviewer'];
  const matrix = [
    [1, 0, 0, 0, 0, 0, 0],
    [3, 2, 2, 1, 0, 0, 0],
    [12,14, 4, 8, 0, 3, 2],
    [5, 0, 7, 2, 3, 0, 0],
    [2, 2, 1, 1, 0, 1, 1]
  ];

  const series = agents.map((agent, ai) => ({
    name: agent,
    data: tools.map((tool, ti) => ({ x: tool, y: matrix[ai][ti] }))
  })).reverse();

  new ApexCharts(document.querySelector('#chart-heatmap'), merge(baseChartOpts, {
    chart: { type: 'heatmap', height: 300, toolbar: { show: false }, animations: { speed: 400 } },
    series,
    dataLabels: { enabled: true, style: { fontSize: '12px', fontWeight: 600, colors: ['#f0f6fc'] } },
    plotOptions: {
      heatmap: {
        radius: 4,
        enableShades: false,
        colorScale: {
          ranges: [
            { from: 0, to: 0,  color: '#1a1e24', name: 'none' },
            { from: 1, to: 2,  color: '#1c3a5e', name: 'low' },
            { from: 3, to: 5,  color: '#1f5f8b', name: 'medium' },
            { from: 6, to: 9,  color: '#2188cc', name: 'high' },
            { from: 10,to: 20, color: '#58a6ff', name: 'very high' }
          ]
        }
      }
    },
    xaxis: { labels: { style: { colors: THEME.textSec, fontSize: '11px' } }, axisBorder: { show: false } },
    yaxis: { labels: { style: { colors: THEME.textSec, fontSize: '12px' } } },
    legend: { show: false },
    tooltip: {
      custom: function({ seriesIndex, dataPointIndex, w }) {
        const s = w.config.series[seriesIndex];
        const d = s.data[dataPointIndex];
        return `<div style="padding:8px 12px;font-size:12px"><strong>${s.name}</strong> &rarr; <strong>${d.x}</strong><br/>${d.y} invocation${d.y!==1?'s':''}</div>`;
      }
    },
    grid: { padding: { right: 10 } }
  })).render();
})();

// ============================================================
//  8. MARKDOWN SUMMARY
// ============================================================
(function(){
  const mdText = `
## Mission Execution Summary

The **OAuth2 authentication flow** implementation was completed successfully within **23 minutes and 47 seconds**, well under the 45-minute budget estimate.

### Key Findings

- **Agent coordination** was highly efficient: the Supervisor maintained oversight while delegating effectively to MissionLead, who orchestrated the Coder, Researcher, and Reviewer agents in parallel where possible.
- The **Coder agent** consumed the most tokens (26,600 total) across three execution spans, producing the bulk of the implementation code.
- **Researcher** completed OAuth2 spec research in just two focused spans, providing the Coder with accurate RFC 6749 references on the first attempt.
- **Token budget utilization** was 67% — leaving comfortable headroom. Output tokens dominated at 70% of total usage.
- Total **cost of $0.47** represents excellent value for an 8-file implementation with full test coverage.

### Performance Highlights

| Metric | Value | Status |
|--------|-------|--------|
| Avg latency per LLM call | 2.1s | Good |
| Peak latency | 4.5s (Step 5, code generation) | Acceptable |
| Tool reuse rate | 87% | Excellent |
| First-pass review approval | Yes | Excellent |
| Test pass rate | 100% (14/14) | Excellent |

### Files Delivered

- \`src/auth/oauth2_handler.py\` — Core OAuth2 flow implementation
- \`src/auth/token_manager.py\` — Token refresh and storage logic
- \`src/auth/scopes.py\` — Scope validation utilities
- \`src/auth/callbacks.py\` — Redirect URI callback handler
- \`tests/test_oauth2_handler.py\` — Unit tests (8 cases)
- \`tests/test_token_manager.py\` — Unit tests (6 cases)
- \`config/oauth2_providers.yaml\` — Provider configuration
- \`docs/auth/oauth2-setup.md\` — Setup documentation

> **Recommendation:** This mission demonstrates that the multi-agent architecture handles authentication feature implementation efficiently. Consider using a similar agent configuration for upcoming API integration tasks.
`;

  document.getElementById('md-summary').innerHTML = marked.parse(mdText);
})();

// ============================================================
//  9. INTERACTIVE TABLE — LLM Call Details
// ============================================================
(function(){
  const columns = ['#','Agent','Model','Purpose','Input Tokens','Output Tokens','Duration','Stop Reason'];

  const rows = [
    [1, 'Supervisor',  'opus',   'Mission planning & delegation',         420,  680,  '1.2s', 'end_turn'],
    [2, 'MissionLead', 'opus',   'Task decomposition for OAuth2 flow',    580,  920,  '2.8s', 'end_turn'],
    [3, 'Researcher',  'haiku',  'Lookup RFC 6749 spec requirements',     210,  340,  '0.9s', 'end_turn'],
    [4, 'Coder',       'opus',   'Generate oauth2_handler.py scaffold',   890, 1510,  '3.4s', 'end_turn'],
    [5, 'Coder',       'opus',   'Implement authorization_code grant',    780, 1320,  '2.1s', 'end_turn'],
    [6, 'Researcher',  'haiku',  'Verify PKCE extension requirements',    180,  380,  '0.6s', 'end_turn'],
    [7, 'Coder',       'opus',   'Generate token_manager.py',            1050, 2150,  '4.2s', 'end_turn'],
    [8, 'MissionLead', 'sonnet', 'Progress checkpoint & re-prioritize',   340,  640,  '1.8s', 'end_turn'],
    [9, 'Coder',       'opus',   'Implement token refresh logic',         720, 1780,  '2.5s', 'end_turn'],
    [10,'Researcher',  'haiku',  'Check provider-specific quirks',        160,  260,  '0.7s', 'end_turn'],
    [11,'Coder',       'opus',   'Generate scopes.py validation',         640, 1380,  '3.8s', 'end_turn'],
    [12,'MissionLead', 'sonnet', 'Coordinate reviewer handoff',           280,  420,  '1.5s', 'end_turn'],
    [13,'Coder',       'opus',   'Implement callback handler',            520, 1100,  '2.2s', 'end_turn'],
    [14,'Reviewer',    'opus',   'Security review of auth flow',          980, 2120,  '3.1s', 'end_turn'],
    [15,'Supervisor',  'opus',   'Final approval & mission close',        500,  680,  '1.9s', 'end_turn']
  ];

  const modelBadge = m => {
    const cls = m === 'opus' ? 'model-opus' : m === 'sonnet' ? 'model-sonnet' : 'model-haiku';
    return `<span class="model-badge ${cls}">${m}</span>`;
  };

  const table = document.getElementById('llm-table');
  const thead = table.querySelector('thead tr');
  const tbody = table.querySelector('tbody');

  // State
  let sortCol = -1, sortDir = 1;

  // Render header
  columns.forEach((col, ci) => {
    const th = document.createElement('th');
    th.innerHTML = col + ' <span class="sort-arrow">&#9650;</span>';
    th.addEventListener('click', () => sortTable(ci));
    thead.appendChild(th);
  });

  function renderRows(data) {
    tbody.innerHTML = '';
    data.forEach(r => {
      const tr = document.createElement('tr');
      r.forEach((cell, ci) => {
        const td = document.createElement('td');
        if (ci === 2) { td.innerHTML = modelBadge(cell); }
        else if (ci === 4 || ci === 5) { td.className = 'num'; td.textContent = cell.toLocaleString(); }
        else if (ci === 0) { td.className = 'num'; td.textContent = cell; }
        else { td.textContent = cell; }
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    });
  }

  function sortTable(ci) {
    if (sortCol === ci) { sortDir *= -1; } else { sortCol = ci; sortDir = 1; }
    // Update header classes
    thead.querySelectorAll('th').forEach((th, i) => {
      th.classList.toggle('sorted', i === ci);
      th.querySelector('.sort-arrow').innerHTML = (i === ci && sortDir === -1) ? '&#9660;' : '&#9650;';
    });
    const sorted = [...rows].sort((a, b) => {
      const va = a[ci], vb = b[ci];
      if (typeof va === 'number') return (va - vb) * sortDir;
      return String(va).localeCompare(String(vb)) * sortDir;
    });
    renderRows(sorted);
  }

  renderRows(rows);
})();
</script>
</body>
</html>
