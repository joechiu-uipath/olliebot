<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Weekly Trends — Activity &amp; Growth Patterns</title>
<script src="https://cdn.jsdelivr.net/npm/echarts@5.6.0/dist/echarts.min.js"></script>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: #0f1117;
    color: #e0e0e0;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    line-height: 1.6;
    padding: 24px 32px 48px;
    min-height: 100vh;
  }

  /* ── Header ── */
  .dashboard-header {
    margin-bottom: 28px;
  }
  .dashboard-header h1 {
    font-size: 1.65rem;
    font-weight: 700;
    color: #e0e0e0;
    letter-spacing: -0.02em;
  }
  .dashboard-header .timestamp {
    font-size: 0.82rem;
    color: #8b8fa3;
    margin-top: 4px;
  }
  .dashboard-header .synopsis {
    font-size: 0.88rem;
    color: #8b8fa3;
    margin-top: 8px;
    max-width: 820px;
    line-height: 1.55;
  }

  /* ── Interactivity hint ── */
  .interaction-hint {
    background: linear-gradient(135deg, rgba(99,102,241,.12), rgba(34,211,238,.08));
    border: 1px solid rgba(99,102,241,.28);
    border-radius: 8px;
    padding: 10px 16px;
    margin-bottom: 24px;
    font-size: 0.8rem;
    color: #a5b4fc;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .interaction-hint .icon {
    font-size: 1rem;
    flex-shrink: 0;
  }

  /* ── KPI Row ── */
  .kpi-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
    margin-bottom: 24px;
  }
  .kpi-card {
    background: #1a1d27;
    border: 1px solid #2a2d37;
    border-radius: 10px;
    padding: 18px 20px;
    display: flex;
    flex-direction: column;
    gap: 4px;
  }
  .kpi-card .kpi-label {
    font-size: 0.76rem;
    color: #8b8fa3;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    font-weight: 500;
  }
  .kpi-card .kpi-value {
    font-size: 1.85rem;
    font-weight: 700;
    letter-spacing: -0.02em;
    line-height: 1.15;
  }
  .kpi-card .kpi-sub {
    font-size: 0.78rem;
    color: #8b8fa3;
  }
  .kpi-card:nth-child(1) .kpi-value { color: #6366f1; }
  .kpi-card:nth-child(2) .kpi-value { color: #10b981; }
  .kpi-card:nth-child(3) .kpi-value { color: #22d3ee; }
  .kpi-card:nth-child(4) .kpi-value { color: #f59e0b; }

  /* ── Chart Cards ── */
  .chart-card {
    background: #1a1d27;
    border: 1px solid #2a2d37;
    border-radius: 10px;
    padding: 20px 22px;
    margin-bottom: 20px;
  }
  .chart-card h2 {
    font-size: 0.95rem;
    font-weight: 600;
    color: #e0e0e0;
    margin-bottom: 14px;
  }

  /* ── Two-col grid ── */
  .two-col {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
  }
  .two-col .chart-card { margin-bottom: 0; }

  /* ── Responsive ── */
  @media (max-width: 960px) {
    .kpi-row { grid-template-columns: repeat(2, 1fr); }
    .two-col { grid-template-columns: 1fr; }
  }
  @media (max-width: 600px) {
    body { padding: 14px; }
    .kpi-row { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>

<!-- ════════════════════ HEADER ════════════════════ -->
<div class="dashboard-header">
  <h1>Weekly Trends &mdash; Activity &amp; Growth Patterns</h1>
  <div class="timestamp" id="timestamp"></div>
  <p class="synopsis">
    Identifies weekly patterns in agent activity, user engagement, and system usage through calendar heatmaps and trend decomposition.
  </p>
</div>

<!-- ════════════════════ INTERACTION HINT ════════════════════ -->
<div class="interaction-hint">
  <span class="icon">&#9432;</span>
  <span>Hover calendar cells for daily detail. Drag data zoom on trend charts. Click legend to toggle series.</span>
</div>

<!-- ════════════════════ KPI ROW ════════════════════ -->
<div class="kpi-row">
  <div class="kpi-card">
    <span class="kpi-label">This Week's Missions</span>
    <span class="kpi-value">47</span>
    <span class="kpi-sub">Mon – Sun total</span>
  </div>
  <div class="kpi-card">
    <span class="kpi-label">Week-over-Week Change</span>
    <span class="kpi-value">+14%</span>
    <span class="kpi-sub">vs. previous week (41 missions)</span>
  </div>
  <div class="kpi-card">
    <span class="kpi-label">Busiest Day</span>
    <span class="kpi-value">Wed</span>
    <span class="kpi-sub">Wednesday, 12 missions</span>
  </div>
  <div class="kpi-card">
    <span class="kpi-label">Quietest Day</span>
    <span class="kpi-value">Sun</span>
    <span class="kpi-sub">Sunday, 2 missions</span>
  </div>
</div>

<!-- ════════════════════ CALENDAR HEATMAP ════════════════════ -->
<div class="chart-card">
  <h2>Mission Activity Calendar (Last 3 Months)</h2>
  <div id="calendarHeatmap" style="width:100%;height:250px;"></div>
</div>

<!-- ════════════════════ WEEKLY KPI TRENDS ════════════════════ -->
<div class="chart-card">
  <h2>Weekly KPI Trends (8 Weeks)</h2>
  <div id="weeklyKpiTrends" style="width:100%;height:370px;"></div>
</div>

<!-- ════════════════════ TWO-COL ROW ════════════════════ -->
<div class="two-col">
  <div class="chart-card">
    <h2>Daily Activity by Hour (This Week)</h2>
    <div id="dailyActivityByHour" style="width:100%;height:360px;"></div>
  </div>
  <div class="chart-card">
    <h2>Mission Volume Forecast (Next 2 Weeks)</h2>
    <div id="missionForecast" style="width:100%;height:360px;"></div>
  </div>
</div>

<!-- ════════════════════ DAY × HOUR HEATMAP ════════════════════ -->
<div class="chart-card">
  <h2>Day of Week &times; Hour Activity Pattern</h2>
  <div id="dayHourHeatmap" style="width:100%;height:340px;"></div>
</div>

<!-- ════════════════════ SCRIPTS ════════════════════ -->
<script>
(function () {
  'use strict';

  /* ── Timestamp ── */
  document.getElementById('timestamp').textContent =
    'Generated ' + new Date().toLocaleString('en-US', {
      weekday: 'long', year: 'numeric', month: 'long', day: 'numeric',
      hour: '2-digit', minute: '2-digit'
    });

  /* ── Palette ── */
  const C = {
    bg: '#0f1117', card: '#1a1d27', border: '#2a2d37',
    text: '#e0e0e0', muted: '#8b8fa3',
    indigo: '#6366f1', cyan: '#22d3ee', green: '#10b981', amber: '#f59e0b'
  };

  /* ═══════════════════════════════════════════════════════════
     1. CALENDAR HEATMAP — last 90 days
     ═══════════════════════════════════════════════════════════ */
  (function () {
    var chart = echarts.init(document.getElementById('calendarHeatmap'));

    // Generate 90 days of data ending today
    var end = new Date();
    end.setHours(0, 0, 0, 0);
    var start = new Date(end);
    start.setDate(start.getDate() - 89);

    var data = [];
    var d = new Date(start);
    // Seeded pseudo-random for reproducibility
    var seed = 42;
    function rand() { seed = (seed * 16807 + 0) % 2147483647; return (seed - 1) / 2147483646; }

    while (d <= end) {
      var dow = d.getDay(); // 0=Sun
      var base;
      if (dow === 0) base = 1 + Math.floor(rand() * 3);            // Sun: 1-3
      else if (dow === 6) base = 2 + Math.floor(rand() * 4);       // Sat: 2-5
      else if (dow === 3) base = 8 + Math.floor(rand() * 6);       // Wed peak: 8-13
      else if (dow === 2 || dow === 4) base = 6 + Math.floor(rand() * 5); // Tue/Thu: 6-10
      else base = 5 + Math.floor(rand() * 5);                      // Mon/Fri: 5-9

      // Slight upward trend over time
      var daysFromStart = Math.round((d - start) / 86400000);
      var trendBoost = Math.floor(daysFromStart / 30);
      var count = Math.max(0, base + trendBoost);

      data.push([echarts.format.formatTime('yyyy-MM-dd', d), count]);
      d = new Date(d.getTime() + 86400000);
    }

    var rangeStart = echarts.format.formatTime('yyyy-MM-dd', start);
    var rangeEnd = echarts.format.formatTime('yyyy-MM-dd', end);

    chart.setOption({
      tooltip: {
        formatter: function (p) {
          return '<b>' + p.value[0] + '</b><br/>Missions: <b>' + p.value[1] + '</b>';
        }
      },
      visualMap: {
        min: 0,
        max: 15,
        calculable: true,
        orient: 'horizontal',
        left: 'center',
        bottom: 4,
        itemWidth: 14,
        itemHeight: 120,
        textStyle: { color: C.muted, fontSize: 11 },
        inRange: {
          color: ['#161b22', '#0e4429', '#006d32', '#26a641', '#39d353']
        }
      },
      calendar: {
        top: 20,
        left: 50,
        right: 40,
        bottom: 46,
        range: [rangeStart, rangeEnd],
        cellSize: ['auto', 18],
        splitLine: { show: false },
        itemStyle: {
          borderWidth: 3,
          borderColor: C.card,
          color: '#161b22'
        },
        yearLabel: { show: false },
        monthLabel: {
          color: C.muted,
          fontSize: 11,
          nameMap: 'en'
        },
        dayLabel: {
          color: C.muted,
          fontSize: 10,
          firstDay: 1,
          nameMap: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']
        }
      },
      series: [{
        type: 'heatmap',
        coordinateSystem: 'calendar',
        data: data
      }]
    });

    window.addEventListener('resize', function () { chart.resize(); });
  })();

  /* ═══════════════════════════════════════════════════════════
     2. WEEKLY KPI TRENDS — 8 weeks, dual Y-axis
     ═══════════════════════════════════════════════════════════ */
  (function () {
    var chart = echarts.init(document.getElementById('weeklyKpiTrends'));

    var weeks = ['W2', 'W3', 'W4', 'W5', 'W6', 'W7', 'W8', 'W9'];
    var missions   = [28, 32, 35, 31, 38, 41, 44, 47];
    var successPct = [88, 91, 89, 92, 90, 93, 91, 94];
    var costPerM   = [1.24, 1.18, 1.21, 1.15, 1.12, 1.09, 1.06, 1.03];
    var latencyMs  = [420, 395, 410, 385, 370, 362, 355, 340];

    chart.setOption({
      tooltip: {
        trigger: 'axis',
        backgroundColor: 'rgba(26,29,39,.95)',
        borderColor: C.border,
        textStyle: { color: C.text, fontSize: 12 }
      },
      legend: {
        data: ['Missions / Week', 'Avg Success Rate (%)', 'Avg Cost / Mission ($)', 'Avg Latency (ms)'],
        top: 0,
        textStyle: { color: C.muted, fontSize: 11 },
        icon: 'roundRect',
        itemWidth: 14,
        itemHeight: 8
      },
      grid: { top: 48, left: 60, right: 68, bottom: 56 },
      xAxis: {
        type: 'category',
        data: weeks,
        axisLabel: { color: C.muted, fontSize: 11 },
        axisLine: { lineStyle: { color: C.border } },
        axisTick: { show: false }
      },
      yAxis: [
        {
          type: 'value',
          name: 'Count / ms',
          nameTextStyle: { color: C.muted, fontSize: 10, padding: [0, 0, 0, -10] },
          axisLabel: { color: C.muted, fontSize: 11 },
          splitLine: { lineStyle: { color: C.border, opacity: 0.4 } },
          min: 0,
          max: 500
        },
        {
          type: 'value',
          name: '% / $',
          nameTextStyle: { color: C.muted, fontSize: 10 },
          axisLabel: { color: C.muted, fontSize: 11 },
          splitLine: { show: false },
          min: 0,
          max: 100
        }
      ],
      dataZoom: [
        { type: 'inside', xAxisIndex: 0 },
        {
          type: 'slider', xAxisIndex: 0, bottom: 8, height: 18,
          borderColor: 'transparent',
          backgroundColor: 'rgba(42,45,55,.5)',
          fillerColor: 'rgba(99,102,241,.18)',
          handleStyle: { color: C.indigo },
          textStyle: { color: C.muted, fontSize: 10 }
        }
      ],
      series: [
        {
          name: 'Missions / Week', type: 'line', yAxisIndex: 0,
          data: missions, smooth: true,
          lineStyle: { color: C.indigo, width: 2.5 },
          itemStyle: { color: C.indigo },
          symbol: 'circle', symbolSize: 6
        },
        {
          name: 'Avg Success Rate (%)', type: 'line', yAxisIndex: 1,
          data: successPct, smooth: true,
          lineStyle: { color: C.green, width: 2 },
          itemStyle: { color: C.green },
          symbol: 'circle', symbolSize: 5
        },
        {
          name: 'Avg Cost / Mission ($)', type: 'line', yAxisIndex: 1,
          data: costPerM.map(function (v) { return +(v * 50).toFixed(1); }), // scale to fit 0-100 axis
          smooth: true,
          lineStyle: { color: C.amber, width: 2 },
          itemStyle: { color: C.amber },
          symbol: 'diamond', symbolSize: 6,
          tooltip: {
            valueFormatter: function (v) { return '$' + (v / 50).toFixed(2); }
          }
        },
        {
          name: 'Avg Latency (ms)', type: 'line', yAxisIndex: 0,
          data: latencyMs, smooth: true,
          lineStyle: { color: C.cyan, width: 2, type: 'dashed' },
          itemStyle: { color: C.cyan },
          symbol: 'triangle', symbolSize: 6
        }
      ]
    });

    window.addEventListener('resize', function () { chart.resize(); });
  })();

  /* ═══════════════════════════════════════════════════════════
     3. DAILY ACTIVITY BY HOUR — stacked bar (Mon-Sun)
     ═══════════════════════════════════════════════════════════ */
  (function () {
    var chart = echarts.init(document.getElementById('dailyActivityByHour'));

    var days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
    //                 Mon Tue Wed Thu Fri Sat Sun
    var morning   = [  3,  4,  5,  4,  3,  2,  1 ];  // 6-12
    var afternoon = [  4,  5,  6,  5,  4,  2,  0 ];  // 12-18
    var evening   = [  2,  2,  3,  2,  2,  1,  1 ];  // 18-24
    var night     = [  0,  0,  0,  1,  0,  0,  0 ];  // 0-6

    chart.setOption({
      tooltip: {
        trigger: 'axis',
        axisPointer: { type: 'shadow' },
        backgroundColor: 'rgba(26,29,39,.95)',
        borderColor: C.border,
        textStyle: { color: C.text, fontSize: 12 }
      },
      legend: {
        data: ['Night (0-6)', 'Morning (6-12)', 'Afternoon (12-18)', 'Evening (18-24)'],
        top: 0,
        textStyle: { color: C.muted, fontSize: 11 },
        icon: 'roundRect',
        itemWidth: 14,
        itemHeight: 8
      },
      grid: { top: 44, left: 44, right: 16, bottom: 28 },
      xAxis: {
        type: 'category',
        data: days,
        axisLabel: { color: C.muted, fontSize: 11 },
        axisLine: { lineStyle: { color: C.border } },
        axisTick: { show: false }
      },
      yAxis: {
        type: 'value',
        name: 'Missions',
        nameTextStyle: { color: C.muted, fontSize: 10 },
        axisLabel: { color: C.muted, fontSize: 11 },
        splitLine: { lineStyle: { color: C.border, opacity: 0.4 } }
      },
      series: [
        {
          name: 'Night (0-6)', type: 'bar', stack: 'total', data: night,
          itemStyle: { color: '#312e81', borderRadius: [0, 0, 0, 0] },
          barWidth: '45%'
        },
        {
          name: 'Morning (6-12)', type: 'bar', stack: 'total', data: morning,
          itemStyle: { color: C.cyan }
        },
        {
          name: 'Afternoon (12-18)', type: 'bar', stack: 'total', data: afternoon,
          itemStyle: { color: C.indigo }
        },
        {
          name: 'Evening (18-24)', type: 'bar', stack: 'total', data: evening,
          itemStyle: { color: C.amber, borderRadius: [3, 3, 0, 0] }
        }
      ]
    });

    window.addEventListener('resize', function () { chart.resize(); });
  })();

  /* ═══════════════════════════════════════════════════════════
     4. MISSION VOLUME FORECAST — solid actual + dashed forecast
     ═══════════════════════════════════════════════════════════ */
  (function () {
    var chart = echarts.init(document.getElementById('missionForecast'));

    // 4 weeks actual (28 days) + 2 weeks forecast (14 days)
    var labels = [];
    var actual = [];
    var forecast = [];
    var confUpper = [];
    var confLower = [];
    // confBand = upper - lower (the band width), used with stack technique
    var confBand = [];

    var seed2 = 99;
    function rand2() { seed2 = (seed2 * 16807) % 2147483647; return (seed2 - 1) / 2147483646; }

    var baseDate = new Date();
    baseDate.setHours(0, 0, 0, 0);
    var startDate = new Date(baseDate);
    startDate.setDate(startDate.getDate() - 27);

    for (var i = 0; i < 42; i++) {
      var dt = new Date(startDate.getTime() + i * 86400000);
      var label = (dt.getMonth() + 1) + '/' + dt.getDate();
      labels.push(label);

      var dow = dt.getDay();
      var base;
      if (dow === 0) base = 2;
      else if (dow === 6) base = 3;
      else if (dow === 3) base = 10;
      else if (dow === 2 || dow === 4) base = 8;
      else base = 6;

      // Linear trend: ~+0.05/day
      var trend = i * 0.05;

      if (i < 28) {
        var val = Math.max(1, Math.round(base + trend + (rand2() - 0.5) * 3));
        actual.push(val);
        forecast.push(null);
        confLower.push(null);
        confBand.push(null);
        confUpper.push(null);
      } else {
        actual.push(null);
        var fc = Math.round(base + trend);
        var spread = 1 + (i - 28) * 0.4;
        var upper = Math.round(fc + spread);
        var lower = Math.max(0, Math.round(fc - spread));
        forecast.push(fc);
        confLower.push(lower);
        confBand.push(upper - lower);
        confUpper.push(upper);
      }
    }

    // Bridge: last actual point also appears as first forecast point
    forecast[27] = actual[27];
    confLower[27] = actual[27];
    confBand[27] = 0;
    confUpper[27] = actual[27];

    chart.setOption({
      tooltip: {
        trigger: 'axis',
        backgroundColor: 'rgba(26,29,39,.95)',
        borderColor: C.border,
        textStyle: { color: C.text, fontSize: 12 },
        formatter: function (params) {
          var idx = params[0].dataIndex;
          var tip = '<b>' + params[0].axisValue + '</b>';
          params.forEach(function (p) {
            if (p.value != null && p.seriesName === 'Actual') {
              tip += '<br/>' + p.marker + ' Actual: <b>' + p.value + '</b>';
            }
            if (p.value != null && p.seriesName === 'Forecast') {
              tip += '<br/>' + p.marker + ' Forecast: <b>' + p.value + '</b>';
            }
          });
          if (confUpper[idx] != null && confLower[idx] != null && idx >= 27) {
            tip += '<br/>Confidence: ' + confLower[idx] + ' \u2013 ' + confUpper[idx];
          }
          return tip;
        }
      },
      legend: {
        data: ['Actual', 'Forecast'],
        top: 0,
        textStyle: { color: C.muted, fontSize: 11 },
        icon: 'roundRect',
        itemWidth: 14,
        itemHeight: 8
      },
      grid: { top: 40, left: 44, right: 16, bottom: 56 },
      xAxis: {
        type: 'category',
        data: labels,
        axisLabel: { color: C.muted, fontSize: 10, rotate: 45, interval: 2 },
        axisLine: { lineStyle: { color: C.border } },
        axisTick: { show: false }
      },
      yAxis: {
        type: 'value',
        name: 'Missions',
        nameTextStyle: { color: C.muted, fontSize: 10 },
        axisLabel: { color: C.muted, fontSize: 11 },
        splitLine: { lineStyle: { color: C.border, opacity: 0.4 } }
      },
      dataZoom: [{ type: 'inside', xAxisIndex: 0 }],
      series: [
        // Confidence band: invisible lower bound stacked with visible band width
        {
          name: 'Lower Bound',
          type: 'line',
          data: confLower,
          lineStyle: { opacity: 0 },
          symbol: 'none',
          stack: 'confidence',
          areaStyle: { opacity: 0 },
          silent: true,
          z: 1
        },
        {
          name: 'Confidence',
          type: 'line',
          data: confBand,
          lineStyle: { opacity: 0 },
          symbol: 'none',
          stack: 'confidence',
          areaStyle: {
            color: 'rgba(34,211,238,0.13)'
          },
          silent: true,
          z: 1
        },
        {
          name: 'Actual', type: 'line', data: actual,
          lineStyle: { color: C.indigo, width: 2.5 },
          itemStyle: { color: C.indigo },
          symbol: 'circle', symbolSize: 4, z: 5
        },
        {
          name: 'Forecast', type: 'line', data: forecast,
          lineStyle: { color: C.cyan, width: 2.5, type: 'dashed' },
          itemStyle: { color: C.cyan },
          symbol: 'diamond', symbolSize: 5, z: 5
        }
      ]
    });

    window.addEventListener('resize', function () { chart.resize(); });
  })();

  /* ═══════════════════════════════════════════════════════════
     5. DAY OF WEEK × HOUR HEATMAP
     ═══════════════════════════════════════════════════════════ */
  (function () {
    var chart = echarts.init(document.getElementById('dayHourHeatmap'));

    var days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
    var hours = [];
    for (var h = 0; h < 24; h++) {
      hours.push(h + ':00');
    }

    // Realistic activity patterns per day-hour
    // Rows = day (0=Mon .. 6=Sun), Cols = hour (0-23)
    var patterns = [
      // Mon
      [0,0,0,0,0,0, 0.5,1.2,2.1,3.0,3.2,2.8, 2.5,3.1,3.4,3.0,2.4,1.8, 1.2,0.8,0.5,0.2,0.1,0],
      // Tue
      [0,0,0,0,0,0, 0.6,1.4,2.4,3.5,3.8,3.2, 2.8,3.4,3.8,3.5,2.8,2.0, 1.4,0.9,0.5,0.2,0.1,0],
      // Wed (busiest)
      [0,0,0,0,0,0.1, 0.8,1.8,3.0,4.2,4.5,4.0, 3.5,4.2,4.6,4.1,3.2,2.4, 1.8,1.2,0.7,0.3,0.1,0],
      // Thu
      [0,0,0,0,0,0, 0.7,1.5,2.6,3.6,3.9,3.4, 3.0,3.6,3.9,3.4,2.6,1.9, 1.3,0.8,0.4,0.2,0.1,0],
      // Fri
      [0,0,0,0,0,0, 0.5,1.2,2.2,3.0,3.2,2.8, 2.4,2.8,3.0,2.5,1.8,1.2, 0.8,0.5,0.3,0.1,0,0],
      // Sat
      [0,0,0,0,0,0, 0,0.2,0.5,1.0,1.4,1.6, 1.5,1.2,1.0,0.8,0.5,0.3, 0.2,0.1,0,0,0,0],
      // Sun
      [0,0,0,0,0,0, 0,0.1,0.2,0.5,0.8,1.0, 0.8,0.6,0.5,0.4,0.3,0.2, 0.1,0,0,0,0,0]
    ];

    var data = [];
    for (var d = 0; d < 7; d++) {
      for (var hr = 0; hr < 24; hr++) {
        data.push([hr, d, patterns[d][hr]]);
      }
    }

    chart.setOption({
      tooltip: {
        formatter: function (p) {
          return '<b>' + days[p.value[1]] + '</b> at <b>' + hours[p.value[0]] + '</b><br/>' +
                 'Avg missions: <b>' + p.value[2].toFixed(1) + '</b>';
        },
        backgroundColor: 'rgba(26,29,39,.95)',
        borderColor: C.border,
        textStyle: { color: C.text, fontSize: 12 }
      },
      grid: { top: 12, left: 52, right: 80, bottom: 48 },
      xAxis: {
        type: 'category',
        data: hours,
        axisLabel: {
          color: C.muted, fontSize: 10,
          interval: 1,
          formatter: function (v, i) { return i % 2 === 0 ? v : ''; }
        },
        axisLine: { lineStyle: { color: C.border } },
        axisTick: { show: false },
        splitArea: { show: false }
      },
      yAxis: {
        type: 'category',
        data: days,
        axisLabel: { color: C.muted, fontSize: 11 },
        axisLine: { show: false },
        axisTick: { show: false },
        splitArea: { show: false }
      },
      visualMap: {
        min: 0,
        max: 4.6,
        calculable: true,
        orient: 'vertical',
        right: 6,
        top: 'center',
        itemHeight: 180,
        itemWidth: 12,
        textStyle: { color: C.muted, fontSize: 10 },
        inRange: {
          color: ['#1a1d27', '#312e81', '#4338ca', '#6366f1', '#818cf8', '#a78bfa', '#c084fc']
        }
      },
      series: [{
        type: 'heatmap',
        data: data,
        label: { show: false },
        itemStyle: {
          borderColor: C.card,
          borderWidth: 2,
          borderRadius: 2
        },
        emphasis: {
          itemStyle: {
            borderColor: '#e0e0e0',
            borderWidth: 1.5
          }
        }
      }]
    });

    window.addEventListener('resize', function () { chart.resize(); });
  })();

})();
</script>
</body>
</html>
